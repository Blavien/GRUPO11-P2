Index: src/main/java/MainClient.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import java.util.ArrayList;\r\nimport java.util.Scanner;\r\n\r\npublic class MainClient {\r\n    private static final Scanner in = new Scanner(System.in);\r\n    private static final ArrayList<Client> clients = new ArrayList<>();\r\n    public static void main ( String[] args ) throws Exception {\r\n        boolean mainAlive = true;\r\n        while (mainAlive){\r\n            boolean subAlive = true;\r\n            boolean handshakeInsuccess = false;\r\n            System.out.println(\"\\n*************** Welcome to GROUP 11 ******************************\\n\");\r\n            System.out.println(\"1. Start a new session\");\r\n            System.out.println(\"2. Go back to a previous session\");\r\n            System.out.println(\"3. Quit\");\r\n            int input = in.nextInt();\r\n            switch(input){\r\n                case 1:\r\n                    boolean clientAlreadyExists = false;\r\n                    Client client = new Client ( 8000);\r\n                    String name = client.getClientName();\r\n\r\n                    //Checks f client is already registered on the Registry.txt\r\n                    // Supostamente, se o cliente esta dentro do array clients - ele já está registado\r\n                    for (Client client1 : clients){\r\n                        if (client1.getClientName().equals(name)) {\r\n                            clientAlreadyExists = true;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if(clientAlreadyExists){\r\n                        System.out.println(\"You already have an account with that username. If you want a new account click 1, else click 2.\");\r\n                    }else{\r\n\r\n                        clients.add(client);\r\n\r\n                        RequestUtils.writeNumberToFile(0,RequestUtils.HANDSHAKE_SIGNAL); // 0 - Nothing\r\n\r\n                        if(RequestUtils.getRequestCounter(client.getClientName()) == 0){   //Request counter do client == 0  - novo ou requests levou reset\r\n\r\n                            RequestUtils.writeNumberToFile(1,RequestUtils.HANDSHAKE_SIGNAL); // 1 - Handshake\r\n\r\n                            handshakeInsuccess = client.doHandshake();\r\n                        }\r\n\r\n                        if(handshakeInsuccess){\r\n                            System.out.println(\"\\nYou have choosen POORLY, so go do a new session.\");\r\n                            clients.remove(client);\r\n                            break;\r\n                        }\r\n\r\n                        RequestUtils.newClientRegister(client.getClientName()); //Fica registado se o hadnshake foi um sucesso\r\n\r\n                        RequestUtils.writeNumberToFile(0,RequestUtils.HANDSHAKE_SIGNAL); // 1 - Handshake\r\n                        while (subAlive){\r\n\r\n                            if(RequestUtils.getRequestCounter(client.getClientName()) == 5){\r\n\r\n                                System.out.println(\"\\nYou have reached max requests. You will be taken to the session restart.\");\r\n                                clients.remove(client);\r\n                                client.endConnection();\r\n                                break;\r\n                            }\r\n\r\n                            System.out.println(\"\\n*************** USER : \"+client.getClientName()+\" *******************\");\r\n                            System.out.println(\"Requests: \"+RequestUtils.getRequestCounter(client.getClientName())+\"\\n\");\r\n                            System.out.println(\"1. Request file\");\r\n                            System.out.println(\"2. Go to main menu\");\r\n                            int req = in.nextInt();\r\n\r\n                            switch (req) {\r\n                                case 1 -> client.execute();\r\n                                case 2 -> subAlive = false;\r\n                            }\r\n                        }\r\n                        break;\r\n                    }\r\n                case 2:\r\n                    System.out.println(\"\\nYou already had an account, you want to go back to that one.\");\r\n                    System.out.println(\"\\nWhat's you name ? \");\r\n                    String c_name = in.next();\r\n                    boolean clientFound = false;\r\n                    Client ourClient = null;\r\n\r\n                    for (Client client1 : clients){\r\n                        if(client1.getClientName().equals(c_name)){\r\n                            ourClient = client1;\r\n                            clientFound = true;\r\n                        }\r\n                    }\r\n\r\n                    if(!clientFound){\r\n                        System.out.println(\"\\nSorry bro, we don't have an active session for that client. Go do it again.\");\r\n                        break;\r\n                    }else{\r\n                        while (subAlive){\r\n\r\n                            if(RequestUtils.getRequestCounter(ourClient.getClientName()) == 5){\r\n\r\n                                System.out.println(\"\\nYou have reached max requests. You will be taken to the session restart.\");\r\n                                clients.remove(ourClient);\r\n                                ourClient.endConnection();\r\n                                break;\r\n                            }\r\n\r\n                            System.out.println(\"\\n*************** USER : \"+ourClient.getClientName()+\" *******************\");\r\n                            System.out.println(\"\\n\"+RequestUtils.getRequestCounter(ourClient.getClientName())+\"\\n\");\r\n                            System.out.println(\"\\n1. Request file\");\r\n                            System.out.println(\"2. Go to main menu\");\r\n                            int req = in.nextInt();\r\n\r\n                            switch (req) {\r\n                                case 1 -> ourClient.execute();\r\n                                case 2 -> subAlive = false;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    break;\r\n                case 3:\r\n                    mainAlive = false;\r\n                    break;\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/MainClient.java b/src/main/java/MainClient.java
--- a/src/main/java/MainClient.java	(revision 8f48d8c6e90d40cd8299aa657e5d4687734aa5db)
+++ b/src/main/java/MainClient.java	(date 1683657341318)
@@ -34,7 +34,7 @@
 
                         clients.add(client);
 
-                        RequestUtils.writeNumberToFile(0,RequestUtils.HANDSHAKE_SIGNAL); // 0 - Nothing
+
 
                         if(RequestUtils.getRequestCounter(client.getClientName()) == 0){   //Request counter do client == 0  - novo ou requests levou reset
 
Index: .idea/shelf/Uncommitted_changes_before_Update_at_08_05_2023_17_32_[Changes]/shelved.patch
===================================================================
diff --git a/.idea/shelf/Uncommitted_changes_before_Update_at_08_05_2023_17_32_[Changes]/shelved.patch b/.idea/shelf/Uncommitted_changes_before_Update_at_08_05_2023_17_32_[Changes]/shelved.patch
deleted file mode 100644
--- a/.idea/shelf/Uncommitted_changes_before_Update_at_08_05_2023_17_32_[Changes]/shelved.patch	(revision 8f48d8c6e90d40cd8299aa657e5d4687734aa5db)
+++ /dev/null	(revision 8f48d8c6e90d40cd8299aa657e5d4687734aa5db)
@@ -1,242 +0,0 @@
-Index: src/main/java/Client.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>import javax.crypto.SecretKey;\r\nimport java.io.*;\r\nimport java.math.BigInteger;\r\nimport java.net.Socket;\r\nimport java.nio.file.Files;\r\nimport java.security.KeyPair;\r\nimport java.util.ArrayList;\r\nimport java.util.Scanner;\r\nimport java.security.KeyPair;\r\nimport java.security.PrivateKey;\r\nimport java.security.PublicKey;\r\n\r\n/**\r\n * This class represents the client. The client sends the messages to the server by means of a socket. The use of Object\r\n * streams enables the sender to send any kind of object.\r\n */\r\npublic class Client {\r\n    private static final String HOST = \"0.0.0.0\";\r\n    private final Socket client;\r\n    private final ObjectInputStream in;\r\n    private final ObjectOutputStream out;\r\n    private boolean isConnected;\r\n    private String client_name;\r\n    private PrivateKey privateKey;\r\n    private PublicKey publicKey;\r\n    private SecretKey macKey;\r\n    private int requestLimit;\r\n    private String fileName;\r\n    private PublicKey serverPublicRSAKey;\r\n    private static final Scanner scan = new Scanner(System.in);\r\n    private BigInteger sharedSecret;\r\n    private ArrayList<Integer> choice;       // get(0) - Hashing algorithm       get(1) - Encryption algorithm\r\n                                                                        //    0 - MAC    1 - Hash                   0 - AES   1 -\r\n    /**\r\n     * Constructs a Client object by specifying the port to connect to. The socket must be created before the sender can\r\n     * send a message.\r\n     *\r\n     * @param port the port to connect to\r\n     * @throws IOException when an I/O error occurs when creating the socket\r\n     */\r\n    public Client(int port) throws Exception {\r\n        this.requestLimit = 0;\r\n\r\n        client = new Socket ( HOST , port );\r\n\r\n        out = new ObjectOutputStream ( client.getOutputStream ( ) );\r\n\r\n        in = new ObjectInputStream ( client.getInputStream ( ) );\r\n\r\n        isConnected = true; // TODO: Check if this is necessary or if it should be controlled\r\n\r\n        // Create a temporary directory for putting the request files\r\n\r\n        //userDir = Files.createTempDirectory ( \"fileServer\" ).toFile ( ).getAbsolutePath ( );\r\n\r\n        System.out.println(\"\\nInsert your username\");\r\n        String name = scan.next();\r\n        this.client_name = name;\r\n\r\n        RSA.storeRSAKeys ( RSA.generateKeyPair() , client_name);\r\n\r\n        this.setPrivateKey();\r\n        this.setPublicKey();\r\n\r\n\r\n    }\r\n    public String getClientName() {\r\n        return client_name;\r\n    }\r\n    public void setClientName(String client_name){\r\n        this.client_name = client_name;\r\n    }\r\n    public void setPrivateKey() throws Exception{ this.privateKey = RSA.getPrivateKey(this.client_name); }\r\n    public void setPublicKey() throws Exception{ this.publicKey = RSA.getPublicKey(this.client_name); }\r\n    public PrivateKey getPrivateKey() throws Exception{ return this.privateKey; }\r\n    public PublicKey getPublicKey() throws Exception{ return RSA.getPublicKey(this.client_name); }\r\n    public void setFileName(String request){\r\n        this.fileName = request;\r\n    }\r\n\r\n    public String getFileName() {\r\n        return this.fileName;\r\n    }\r\n\r\n    public void setConnected(boolean bool) {\r\n        this.isConnected = bool;\r\n    }\r\n\r\n    public boolean doHandshake() throws Exception {\r\n        boolean handshakeInsuccess = false;\r\n        boolean invalid_choice_hashing = false;\r\n        boolean invalid_choice_encryption = false;\r\n        choice = new ArrayList<Integer>(); //Array novo sempre que isto é chamado\r\n\r\n        System.out.println(\"\\nWe will make you set up your commmunication and security, cause I want 20.\");\r\n\r\n        // choice.get(0)\r\n        System.out.println(\"\\nHashing algoritm:\");\r\n        System.out.println(\"0. MAC\");\r\n        System.out.println(\"1. Hash of 512 bits (SHA - 512)\");\r\n        System.out.println(\"2. 2048 eggs & bacon\");\r\n        System.out.println(\"3. CBC\");\r\n        int i = scan.nextInt();\r\n        switch (i){\r\n            case 0:\r\n                choice.add(0); // [0] = 0\r\n                break;\r\n            case 1:\r\n                choice.add(1); // [0] = 1\r\n                break;\r\n            case 2:\r\n                invalid_choice_hashing = true;\r\n                break;\r\n            case 3:\r\n                invalid_choice_hashing = true;\r\n                break;\r\n        }\r\n        // choice.get(1)\r\n        System.out.println(\"\\nEncryption/Decryption algoritm:\");\r\n        System.out.println(\"0. AES\");\r\n        System.out.println(\"1. DES\");\r\n        System.out.println(\"2. 360-no-scope-DES\");\r\n        System.out.println(\"3. CBC\");\r\n        i = scan.nextInt();\r\n        switch (i){\r\n            case 0:\r\n                choice.add(0); // [1] = 0\r\n                break;\r\n            case 1:\r\n                choice.add(1); // [1] = 1\r\n                break;\r\n            case 2:\r\n                invalid_choice_encryption = true;\r\n                break;\r\n            case 3:\r\n                invalid_choice_encryption = true;\r\n                break;\r\n        }\r\n\r\n        //Faz o handshake\r\n        if(invalid_choice_hashing == false && invalid_choice_encryption == false){\r\n            serverPublicRSAKey = rsaKeyDistribution();\r\n            sharedSecret = agreeOnSharedSecret ( serverPublicRSAKey );\r\n\r\n            macKey=MAC.createMACKey();\r\n            System.out.println(choice);\r\n            sendClientChoice();\r\n\r\n            if(choice.get(0) == 0){\r\n                sendMacKey();\r\n            }\r\n        }else{\r\n            handshakeInsuccess = true;\r\n            System.out.println(\"This server doesn't support those algorithms.\");\r\n        }\r\n        return handshakeInsuccess;\r\n    }\r\n    public void sendClientChoice() throws IOException {\r\n        out.writeObject(choice);\r\n        out.flush ();\r\n    }\r\n    public void endConnection() throws Exception {\r\n        this.closeConnection();\r\n    }\r\n\r\n    /**\r\n     * Reads the response from the server and writes the file to the temporary directory.\r\n     *\r\n     * @param fileName the name of the file to write\r\n     */\r\n    private void processResponse(String fileName) throws Exception {\r\n        String unitedMessage = \"\";\r\n\r\n        //BigInteger sharedSecret = agreeOnSharedSecret(serverPublicRSAKey);\r\n\r\n        Message response = (Message) in.readObject();\r\n        byte[] decryptedFile = null;\r\n        //CRYPTO\r\n        if(choice.get(1) == 0) {\r\n            decryptedFile = AES.decrypt(response.getMessage(), sharedSecret.toByteArray());\r\n        }else if(choice.get(1) == 1){\r\n            decryptedFile = DES.decrypt(response.getMessage(), sharedSecret.toByteArray());\r\n\r\n        }\r\n        //HASHING\r\n        byte[] computedDigest = null;\r\n        if(choice.get(0) == 0) {\r\n            computedDigest = MAC.generateMAC(decryptedFile, macKey);\r\n            if (!MAC.verifyMAC(response.getSignature(), computedDigest)) {\r\n                throw new RuntimeException(\"The integrity of the message is not verified\");\r\n            }\r\n        }else if(choice.get(0) == 1){\r\n            computedDigest = Hash.generateDigest(decryptedFile);\r\n            if (!Hash.verifyDigest(response.getSignature(), computedDigest)) {\r\n                throw new RuntimeException(\"The integrity of the message is not verified\");\r\n            }\r\n        }\r\n\r\n        String decryptedContent = new String(decryptedFile);  // To handle divided content\r\n\r\n        if (decryptedContent.equals(\"INICIO\")) { //Decrypts this first message - INICIO\r\n\r\n            //System.out.println(\"Recebeu o inicio\");\r\n\r\n            while (!decryptedContent.equals(\"FIM\")){ //Decrypts the rest of the message until we get the last message - FIM\r\n\r\n                response = (Message) in.readObject();\r\n                //CRYPTO\r\n                if(choice.get(1) == 0) {\r\n                    decryptedFile = AES.decrypt(response.getMessage(), sharedSecret.toByteArray());\r\n                }else if(choice.get(1) == 1){\r\n                    decryptedFile = DES.decrypt(response.getMessage(), sharedSecret.toByteArray());\r\n\r\n                }\r\n                //HASHING\r\n                if(choice.get(0) == 0) {\r\n                    computedDigest = MAC.generateMAC(decryptedFile, macKey);\r\n                    if (!MAC.verifyMAC(response.getSignature(), computedDigest)) {\r\n                        throw new RuntimeException(\"The integrity of the message is not verified\");\r\n                    }\r\n                }else if(choice.get(0) == 1){\r\n                    computedDigest = Hash.generateDigest(decryptedFile);\r\n                    if (!Hash.verifyDigest(response.getSignature(), computedDigest)) {\r\n                        throw new RuntimeException(\"The integrity of the message is not verified\");\r\n                    }\r\n                }\r\n\r\n                decryptedContent = new String(decryptedFile);\r\n\r\n                unitedMessage +=new String(decryptedFile);\r\n            }\r\n            System.out.println(\"We have reached the end of the file content.\");\r\n\r\n            System.out.println(\"This is the file content:\");\r\n\r\n            System.out.println(new String (unitedMessage));\r\n\r\n            saveFiles(unitedMessage);\r\n\r\n        }else{\r\n            saveFiles(new String(decryptedFile));\r\n        }\r\n    }\r\n\r\n    public void saveFiles(String decryptedFile) throws Exception{\r\n        //Criação da pasta que receberá os ficheiros\r\n        String privateClientPath = this.client_name + \"/files\";\r\n        File privateClientFolder = new File(privateClientPath);\r\n        privateClientFolder.mkdirs();\r\n\r\n        //Criação do ficheiro de texto que receberá o conteúdo do ficheiro de texto pedido e a escrita do mesmo\r\n        String decryptedFileString = decryptedFile;\r\n        File arquivo = new File(this.client_name + \"/files/User_\" + this.getFileName());\r\n        BufferedWriter bw = new BufferedWriter(new FileWriter(arquivo));\r\n        bw.write(decryptedFileString);\r\n        bw.close();\r\n    }\r\n    /**\r\n     * Closes the connection by closing the socket and the streams.\r\n     */\r\n    private void closeConnection ( ) {\r\n        try {\r\n            client.close ( );\r\n            out.close ( );\r\n            in.close ( );\r\n        } catch ( IOException e ) {\r\n            throw new RuntimeException ( e );\r\n        }\r\n    }\r\n\r\n    private void sendPublicDHKey ( byte[] publicKey ) throws Exception {\r\n        out.writeObject ( publicKey );\r\n    }\r\n\r\n    private PublicKey rsaKeyDistribution ( ) throws Exception {\r\n        // Sends the public key\r\n        sendPublicRSAKey ( );\r\n        // Receive the public key of the sender\r\n        return ( PublicKey ) in.readObject ( );\r\n    }\r\n\r\n    private void sendPublicRSAKey ( ) throws IOException {\r\n        out.writeObject ( publicKey );\r\n        out.flush ( );\r\n    }\r\n    private void sendMacKey() throws Exception{\r\n        out.writeObject(macKey);\r\n        out.flush ();\r\n    }\r\n    public void sendMessage ( String message ) throws Exception {\r\n        // Agree on a shared secret\r\n        // BigInteger sharedSecret = agreeOnSharedSecret ( serverPublicRSAKey );\r\n        // Encrypts the message\r\n        byte[] encryptedMessage = null;\r\n        if(choice.get(1) == 0){ //AES\r\n            encryptedMessage = AES.encrypt ( message.getBytes ( ) , sharedSecret.toByteArray ( ) );\r\n        }\r\n        if(choice.get(1) == 1){ //DES\r\n            encryptedMessage = DES.encrypt ( message.getBytes ( ) , sharedSecret.toByteArray ( ) );\r\n        }\r\n        byte[] digest = null;\r\n\r\n        if(choice.get(0) == 0){ //MAC\r\n            // Generates the MAC\r\n            digest = MAC.generateMAC(message.getBytes ( ),macKey);\r\n        }else if(choice.get(0) == 1){ //HASH\r\n            digest = Hash.generateDigest(message.getBytes ( ));\r\n        }\r\n        // Creates the message object\r\n        Message messageObj = new Message ( encryptedMessage , digest );\r\n        // Sends the encrypted message\r\n        out.writeObject ( messageObj );\r\n        out.flush();\r\n    }\r\n    private BigInteger agreeOnSharedSecret (PublicKey serverPublicRSAKey ) throws Exception {\r\n        // Generates a private key\r\n        BigInteger privateDHKey = DiffieHellman.generatePrivateKey ( );\r\n        BigInteger publicDHKey = DiffieHellman.generatePublicKey ( privateDHKey );\r\n        // Sends the public key to the server encrypted\r\n        sendPublicDHKey ( RSA.encryptRSA ( publicDHKey.toByteArray ( ) , privateKey ) );\r\n        // Waits for the server to send his public key\r\n        BigInteger serverPublicKey = new BigInteger ( RSA.decryptRSA ( ( byte[] ) in.readObject ( ) , serverPublicRSAKey ) );\r\n        // Generates the shared secret\r\n        return DiffieHellman.computePrivateKey ( serverPublicKey , privateDHKey );\r\n    }\r\n\r\n    /**\r\n     * Executes the client. It reads the file from the console and sends it to the server. It waits for the response and\r\n     * writes the file to the temporary directory.\r\n     */\r\n    public void execute() throws Exception{\r\n        Scanner usrInput = new Scanner ( System.in );\r\n        if( isConnected ) {\r\n            // Reads the message to extract the path of the file\r\n            System.out.println ( \"Write the path of the file\" );\r\n            String request = \"USERNAME: \"+this.client_name+ \": \"+usrInput.nextLine ( );\r\n            this.setFileName(RequestUtils.splitRequest(request).get(1));\r\n            // Request the file\r\n            sendMessage ( request );\r\n            // Waits for the response\r\n            processResponse ( RequestUtils.getFileNameFromRequest ( request ) );\r\n        }\r\n    }\r\n\r\n\r\n}
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/src/main/java/Client.java b/src/main/java/Client.java
---- a/src/main/java/Client.java	(revision 6a82080d1e2bd7670f70553fcd8edc262ee65f0d)
-+++ b/src/main/java/Client.java	(date 1683563461728)
-@@ -119,8 +119,8 @@
-         System.out.println("\nEncryption/Decryption algoritm:");
-         System.out.println("0. AES");
-         System.out.println("1. DES");
--        System.out.println("2. 360-no-scope-DES");
--        System.out.println("3. CBC");
-+        System.out.println("2. 3DES");
-+        System.out.println("3. 360-no-scope-DES");
-         i = scan.nextInt();
-         switch (i){
-             case 0:
-@@ -130,7 +130,7 @@
-                 choice.add(1); // [1] = 1
-                 break;
-             case 2:
--                invalid_choice_encryption = true;
-+                choice.add(2); // [1] = 2
-                 break;
-             case 3:
-                 invalid_choice_encryption = true;
-@@ -178,9 +178,12 @@
-         //CRYPTO
-         if(choice.get(1) == 0) {
-             decryptedFile = AES.decrypt(response.getMessage(), sharedSecret.toByteArray());
--        }else if(choice.get(1) == 1){
-+        }
-+        if(choice.get(1) == 1){
-             decryptedFile = DES.decrypt(response.getMessage(), sharedSecret.toByteArray());
--
-+        }
-+        if(choice.get(1) == 2){
-+            decryptedFile = DES3.decrypt(response.getMessage(), sharedSecret.toByteArray());
-         }
-         //HASHING
-         byte[] computedDigest = null;
-@@ -208,9 +211,12 @@
-                 //CRYPTO
-                 if(choice.get(1) == 0) {
-                     decryptedFile = AES.decrypt(response.getMessage(), sharedSecret.toByteArray());
--                }else if(choice.get(1) == 1){
-+                }
-+                if(choice.get(1) == 1){
-                     decryptedFile = DES.decrypt(response.getMessage(), sharedSecret.toByteArray());
--
-+                }
-+                if(choice.get(1) == 2){
-+                    decryptedFile = DES3.decrypt(response.getMessage(), sharedSecret.toByteArray());
-                 }
-                 //HASHING
-                 if(choice.get(0) == 0) {
-@@ -298,6 +304,10 @@
-         if(choice.get(1) == 1){ //DES
-             encryptedMessage = DES.encrypt ( message.getBytes ( ) , sharedSecret.toByteArray ( ) );
-         }
-+        if(choice.get(1) == 2){
-+            encryptedMessage = DES3.encrypt(message.getBytes(), sharedSecret.toByteArray());
-+        }
-+
-         byte[] digest = null;
- 
-         if(choice.get(0) == 0){ //MAC
-Index: src/main/java/ClientHandler.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>import javax.crypto.SecretKey;\r\nimport java.io.IOException;\r\nimport java.io.ObjectInputStream;\r\nimport java.io.ObjectOutputStream;\r\nimport java.math.BigInteger;\r\nimport java.net.Socket;\r\nimport java.security.PublicKey;\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\n/**\r\n * This class represents the client handler. It handles the communication with the client. It reads the file from the\r\n * server and sends it to the client.\r\n */\r\npublic class ClientHandler extends Thread {\r\n    private final ObjectInputStream in;\r\n    private final ObjectOutputStream out;\r\n    private final Socket client;\r\n    private ArrayList<String> requestSplit;\r\n    private SecretKey clientMACKey;\r\n    private ArrayList<Integer> clientChoice;\r\n\r\n    /**\r\n     * Creates a ClientHandler object by specifying the socket to communicate with the client. All the processing is\r\n     * done in a separate thread.\r\n     *\r\n     * @throws IOException when an I/O error occurs when creating the socket\r\n     */\r\n    public ClientHandler (Socket client) throws Exception {\r\n        this.client = client;\r\n        in = new ObjectInputStream ( this.client.getInputStream ( ) );\r\n        out = new ObjectOutputStream ( this.client.getOutputStream ( ) );\r\n        boolean isConnected = true; // TODO: Check if this is necessary or if it should be controlled\r\n    }\r\n\r\n    @Override\r\n    public void run ( ) {\r\n        super.run ( );\r\n        try {\r\n            sleep(2000);\r\n            PublicKey clientPublicRSAKey;\r\n\r\n            while(RequestUtils.readNumberFromFile(RequestUtils.HANDSHAKE_SIGNAL) != 1){  }\r\n\r\n            clientPublicRSAKey = rsaKeyDistribution ( in );\r\n            BigInteger sharedSecret = agreeOnSharedSecret ( clientPublicRSAKey );\r\n            System.out.println(\"SERVER : Handshake was a sucess.\");\r\n\r\n\r\n            clientChoice = receiveClientChoice();\r\n            System.out.print(\"SERVER : Client setup \");\r\n            printClientChoice(clientChoice);\r\n\r\n            if(clientChoice.get(0) == 0){\r\n                clientMACKey = receiveMacKey();\r\n                System.out.println(\"SERVER : MACK Key received.\");\r\n            }\r\n\r\n            int i = 0;\r\n            while ( i != 5) {\r\n\r\n                byte[] message = process ( in , sharedSecret.toByteArray ( ), clientChoice );\r\n\r\n                if(message != null ){\r\n                    System.out.println(\"\\n***** REQUEST *****\\n\"+ new String(message));\r\n\r\n                    //Splits message received\r\n\r\n                    requestSplit = RequestUtils.splitRequest(new String(message));\r\n\r\n                    //Regista os número de pedidos feitos por este utilizador\r\n\r\n                    RequestUtils.registerRequests (requestSplit);\r\n\r\n                    // Reads the file and sends it to the client\r\n\r\n                    byte[] content = FileHandler.readFile ( RequestUtils.getAbsoluteFilePath ( requestSplit.get(1) ) );\r\n\r\n                    String auxContent = new String(content);\r\n                    System.out.println(\"\\n***** FILE ********\\nHere's the file content: \");\r\n                    System.out.println(auxContent);\r\n\r\n                    int contentSize = content.length;\r\n                    //int numParts = (int) Math.ceil((double) contentSize / 2048);\r\n\r\n                    if(contentSize>2048) {\r\n\r\n                        sendFile(\"INICIO\".getBytes(), sharedSecret.toByteArray (), clientChoice);\r\n\r\n                        ArrayList<byte[]> contentDividido = ByteUtils.splitByteArray(auxContent.getBytes(),2048 );\r\n\r\n                        for (int j = 0; j < contentDividido.size(); j++) {\r\n\r\n                            sendFile(contentDividido.get(j), sharedSecret.toByteArray (), clientChoice);\r\n                            System.out.println(new String(contentDividido.get(j)));\r\n\r\n                        }\r\n                        sendFile(\"FIM\".getBytes(), sharedSecret.toByteArray (), clientChoice);\r\n                    }\r\n                    else {\r\n\r\n                        sendFile(content, sharedSecret.toByteArray (), clientChoice);\r\n\r\n                    }\r\n                    i = RequestUtils.requestLimit(requestSplit.get(0));\r\n\r\n                    //System.out.println(requestSplit.get(0)+\" - Request counter: \"+i);\r\n\r\n                }\r\n            }\r\n            if(i >= 5){\r\n\r\n                System.out.println(\"\\nClient \"+requestSplit.get(0) +\" exceeded the max requests.\");\r\n\r\n                RequestUtils.resetRequestCounter(requestSplit.get(0));\r\n\r\n                System.out.println(\"Client \"+requestSplit.get(0) +\" request counter has been reset to 0.\");\r\n            }\r\n\r\n            System.out.println(\"Closing socket connection.\");\r\n\r\n            closeConnection ( );\r\n        } catch ( IOException | ClassNotFoundException e ) {\r\n\r\n            closeConnection ( );\r\n\r\n        } catch (Exception e) {\r\n\r\n            throw new RuntimeException(e);\r\n\r\n        }\r\n    }\r\n    public void printClientChoice(ArrayList<Integer> clientChoice){\r\n        switch (clientChoice.get(0)) {\r\n            case 0:\r\n                System.out.print(\"[ MAC , \");\r\n                break;\r\n            case 1:\r\n                System.out.print(\"[ HASH , \");\r\n                break;\r\n        }\r\n        switch (clientChoice.get(1)) {\r\n            case 0:\r\n                System.out.print(\"AES ]\");\r\n                break;\r\n            case 1:\r\n                System.out.print(\"DES ]\");\r\n                break;\r\n        }\r\n        System.out.println(\"\\n\");\r\n    }\r\n    public static List<String> splitStringBySize(String input) {\r\n        List<String> output = new ArrayList<>();\r\n\r\n        // Verifica o tamanho da string em bytes\r\n        int inputSize = input.getBytes().length;\r\n\r\n        if (inputSize <= 2048) { // Se o tamanho for menor ou igual a 2KB, adiciona a string inteira na lista de saída\r\n            output.add(input);\r\n        } else { // Caso contrário, divide a string em pedaços de no máximo 2KB\r\n            int numParts = (int) Math.ceil((double) inputSize / 2048); // Calcula o número de pedaços necessários\r\n            int remainingBytes = inputSize;\r\n            int start = 0;\r\n            int end = 0;\r\n\r\n            for (int i = 0; i < numParts; i++) {\r\n                end += (remainingBytes > 2048) ? 2048 : remainingBytes; // Define o final do pedaço, garantindo que não ultrapasse 2KB\r\n                String part = input.substring(start, end); // Extrai o pedaço da string original\r\n                output.add(part); // Adiciona o pedaço na lista de saída\r\n                start = end;\r\n                remainingBytes = inputSize - end;\r\n            }\r\n        }\r\n\r\n        return output;\r\n    }\r\n\r\n\r\n    /**\r\n     * Sends the file to the client\r\n     *\r\n     * @param content the content of the file to send\r\n     *\r\n     * @throws IOException when an I/O error occurs when sending the file\r\n     */\r\n    private void sendFile ( byte[] content , byte[] sharedSecret , ArrayList<Integer> choice) throws Exception {\r\n        byte[] encryptedResponse = null;\r\n\r\n        if(choice.get(1) == 0){ //AES\r\n            encryptedResponse = AES.encrypt ( content , sharedSecret );\r\n        }\r\n        if(choice.get(1) == 1){ //DES\r\n            encryptedResponse = DES.encrypt ( content , sharedSecret );\r\n        }\r\n        byte[] digest = null;\r\n\r\n        if(choice.get(0) == 0){ //MAC\r\n            // Generates the MAC\r\n            digest = MAC.generateMAC ( content, clientMACKey );\r\n        }else if(choice.get(0) == 1){ //HASH\r\n            digest = Hash.generateDigest(content);\r\n        }\r\n        // Creates the message object\r\n        Message responseObj = new Message ( encryptedResponse , digest );\r\n        // Sends the encrypted message\r\n        out.writeObject ( responseObj );\r\n        out.flush ( );\r\n    }\r\n\r\n    /**\r\n     * Closes the connection by closing the socket and the streams.\r\n     */\r\n    private void closeConnection ( ) {\r\n        try {\r\n            client.close ( );\r\n            out.close ( );\r\n            in.close ( );\r\n        } catch ( IOException e ) {\r\n            throw new RuntimeException ( e );\r\n        }\r\n    }\r\n    private SecretKey receiveMacKey() throws IOException, ClassNotFoundException {\r\n        SecretKey macKey = ( SecretKey ) in.readObject ( );\r\n        return macKey;\r\n    }\r\n    private ArrayList<Integer> receiveClientChoice () throws IOException, ClassNotFoundException {\r\n        ArrayList<Integer> choice = (ArrayList<Integer>) in.readObject();\r\n        return choice;\r\n    }\r\n    //DIFFIE HELLLMAN\r\n    private PublicKey rsaKeyDistribution (ObjectInputStream in ) throws Exception {\r\n        // Extract the public key\r\n        PublicKey senderPublicRSAKey = ( PublicKey ) in.readObject ( );\r\n        // Send the public key\r\n        sendPublicRSAKey ( );\r\n        return senderPublicRSAKey;\r\n    }\r\n    private void sendPublicRSAKey ( ) throws Exception {\r\n        out.writeObject ( Server.getPublicRSAKey());\r\n        out.flush ( );\r\n    }\r\n\r\n    private void sendPublicDHKey ( BigInteger publicKey ) throws Exception {\r\n        out.writeObject ( RSA.encryptRSA ( publicKey.toByteArray ( ) , Server.getPrivateRSAKey()));\r\n    }\r\n    /**\r\n     * Performs the Diffie-Hellman algorithm to agree on a shared private key.\r\n     *\r\n     * @param senderPublicRSAKey the public key of the sender\r\n     *\r\n     * @return the shared secret key\r\n     *\r\n     * @throws Exception when the key agreement protocol fails\r\n     */\r\n    private BigInteger agreeOnSharedSecret ( PublicKey senderPublicRSAKey ) throws Exception {\r\n        // Generate a pair of keys\r\n        BigInteger privateKey = DiffieHellman.generatePrivateKey ( );\r\n        BigInteger publicKey = DiffieHellman.generatePublicKey ( privateKey );\r\n        // Extracts the public key from the request\r\n        BigInteger clientPublicKey = new BigInteger ( RSA.decryptRSA ( ( byte[] ) in.readObject ( ) , senderPublicRSAKey ) );\r\n        // Send the public key to the client\r\n        sendPublicDHKey ( publicKey );\r\n        // Generates the shared secret\r\n        return DiffieHellman.computePrivateKey ( clientPublicKey , privateKey );\r\n    }\r\n\r\n    private byte[] process ( ObjectInputStream in , byte[] sharedSecret, ArrayList<Integer> clientChoice ) throws Exception {\r\n        // Reads the message object\r\n        Message messageObj = ( Message ) in.readObject ( );\r\n        // Extracts and decrypt the message\r\n        byte[] decryptedMessage = null;\r\n        if(clientChoice.get(1) == 0){\r\n            decryptedMessage = AES.decrypt ( messageObj.getMessage ( ) , sharedSecret );\r\n        }\r\n        if(clientChoice.get(1) == 1){\r\n            decryptedMessage = DES.decrypt ( messageObj.getMessage ( ) , sharedSecret );\r\n        }\r\n        // Computes the digest of the received message\r\n        byte[] computedDigest = null;\r\n        if(clientChoice.get(0) == 0){\r\n            computedDigest = MAC.generateMAC ( decryptedMessage, clientMACKey );\r\n            if ( ! MAC.verifyMAC ( messageObj.getSignature ( ) , computedDigest ) ) {\r\n                throw new RuntimeException ( \"The integrity of the message is not verified\" );\r\n            }\r\n        }\r\n        if (clientChoice.get(0) == 1){\r\n            //decryptedMessage = 3DES.decrypt ( messageObj.getMessage ( ) , sharedSecret );\r\n            computedDigest = Hash.generateDigest(decryptedMessage);\r\n            if ( ! Hash.verifyDigest ( messageObj.getSignature ( ) , computedDigest ) ) {\r\n                throw new RuntimeException ( \"The integrity of the message is not verified\" );\r\n            }\r\n        }\r\n        // Verifies the integrity of the message\r\n\r\n        return decryptedMessage;\r\n    }\r\n}\r\n
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/src/main/java/ClientHandler.java b/src/main/java/ClientHandler.java
---- a/src/main/java/ClientHandler.java	(revision 6a82080d1e2bd7670f70553fcd8edc262ee65f0d)
-+++ b/src/main/java/ClientHandler.java	(date 1683563461734)
-@@ -30,7 +30,6 @@
-         this.client = client;
-         in = new ObjectInputStream ( this.client.getInputStream ( ) );
-         out = new ObjectOutputStream ( this.client.getOutputStream ( ) );
--        boolean isConnected = true; // TODO: Check if this is necessary or if it should be controlled
-     }
- 
-     @Override
-@@ -146,6 +145,9 @@
-             case 1:
-                 System.out.print("DES ]");
-                 break;
-+            case 2:
-+                System.out.print("3DES ]");
-+                break;
-         }
-         System.out.println("\n");
-     }
-@@ -192,6 +194,9 @@
-         if(choice.get(1) == 1){ //DES
-             encryptedResponse = DES.encrypt ( content , sharedSecret );
-         }
-+        if(choice.get(1) == 2){ //DES
-+            encryptedResponse = DES3.encrypt ( content , sharedSecret );
-+        }
-         byte[] digest = null;
- 
-         if(choice.get(0) == 0){ //MAC
-@@ -275,6 +280,9 @@
-         if(clientChoice.get(1) == 1){
-             decryptedMessage = DES.decrypt ( messageObj.getMessage ( ) , sharedSecret );
-         }
-+        if(clientChoice.get(1) == 2){
-+            decryptedMessage = DES3.decrypt ( messageObj.getMessage ( ) , sharedSecret );
-+        }
-         // Computes the digest of the received message
-         byte[] computedDigest = null;
-         if(clientChoice.get(0) == 0){
-Index: Re/private/privateKey.key
-===================================================================
-diff --git a/Re/private/privateKey.key b/Re/private/privateKey.key
-deleted file mode 100644
---- a/Re/private/privateKey.key	(revision 6a82080d1e2bd7670f70553fcd8edc262ee65f0d)
-+++ /dev/null	(revision 6a82080d1e2bd7670f70553fcd8edc262ee65f0d)
-@@ -1,11 +0,0 @@
--�� sr java.security.KeyRep��O����C L 	algorithmt Ljava/lang/String;[ encodedt [BL formatq ~ L typet Ljava/security/KeyRep$Type;xpt RSAur [B���T�  xp  �0�� 0
--	*�H��
-- ��0�� � �E�DP{��vڴ2{�i~�=�'�ts[
--!�^�r�s3(0��a?a��H�Đ�X���cX}P�6w��d�����z7úWp 3|�� ~g��y(�2��5��,X���r9}JK�I��P��&��q���e��鎕��;��I3j	/��TaK���H��	�������s�*Đ �2k ?]v�t"z�l�6_,�T�u�&�
--��׺���o ����G��;�]2鱩�
--�Ѕ��� �l>Q0���lt�5i_I � |�Eˬ�/�Vf����V	�Q\!du�NV���.9�c��ᖍ�o؝$q���=^��G��8�9/7�-Xc�,4�h����I�>��3�2�ܱ����5yj���I�
--��ȷ�(�2��Ӣq���{�-��&т[P�j�4�%����؋�D�![r��;�k�.6Լ@��+Q�q!�D0m8��§� w��<�~
--�\��u�h� ӗ\0������NX�xՂU��C�.M}=���za�� �� >.�:�m�}����RA��+��wp*�YYV%�`�U�^�(����5�X'cY�5(����T�У:��0�������O\��]�*h
--�M!0yA�4�m�?mqEVۃ\��tH��Za�� �ʾ:\�����O�`������z��?���&���~�����Zmt�P8.1�G�׼�vw�ptG�ˈ9�I��?�U��d�(˯��2����[!B�_�9 IUל�Db��*N���`�v��UM�a�=��� �H�5�Ϣ��~�}�!J�:�Ģ�����ϛ�=�w^A%���4��X���­��o�*N��.�&�����w鸗�2,UX�\5PO�J��V�bƴ�i*ݟtj�3������Y����]�ח���z)����;(FwM,{~�Y�M�|�ʭ,��t�X�m;��g�A���^{o�g ���~���#%_�E-�2O��A�M��C�� ���T"�kA�˪q!?(�)
--�#974�a���&;z>�89�d����NߒT�m��e�����j��m�� :�����s��I�g�j���8`�,γ��� �гO���šǀ ����أ~����(�7;��B��hc
--xat�[)�<�u�8˱r	P�Ⱥ��D� ��4��*U_��t PKCS#8~r java.security.KeyRep$Type          xr java.lang.Enum          xpt PRIVATE
-\ No newline at end of file
-Index: Sara/private/privateKey.key
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/Sara/private/privateKey.key b/Sara/private/privateKey.key
-deleted file mode 100644
---- a/Sara/private/privateKey.key	(revision 6a82080d1e2bd7670f70553fcd8edc262ee65f0d)
-+++ /dev/null	(revision 6a82080d1e2bd7670f70553fcd8edc262ee65f0d)
-@@ -1,15 +0,0 @@
--�� sr java.security.KeyRep��O����C L 	algorithmt Ljava/lang/String;[ encodedt [BL formatq ~ L typet Ljava/security/KeyRep$Type;xpt RSAur [B���T�  xp  �0�� 0
--	*�H��
-- ��0�� � �c�V�N�{X��9P�J=8"cH���U~���~ߊ��u��(�����J�jS�&��|����&*a�g�o�q��7��Z*�2���R�B	�M�B�A
--� hZ V��<2#leL?��H%���9!UQ��٬0`|WH`���F�U9
--�	�.�EMW�h��:AC�}�pa�(�QfB�����G�-�����*�g-�@i&E_�q��ߞ��$� 4P��؉����A�u��3��'��)����N��ej+�ɡxV���y � 
--��<���[)є1c~���_�ה�E^Ա��͉S��*I���G���C:h�Q{m���~�<�0M(>�jGP>RĪ+�����R�(i8M��_�"��g���.<�Xq�u[�F,���I-���+�>�Q�E�Ƌ[�� �vF �`�Ųy�_*)���xS#* ���K�x!;��V��"�&e2�0�Y|V��e�́��B�g�!E�.�K�+0���!N���{�1ߜ����������J��;ȇ��� ��� o��]���^�<&���ԁ�E�<&�
--���]w�R��t�@d�n���'X���a��'vn��Mp���ht��P������!��E�U�Pޫ%��l�;���U�u�`Ý�J={�#��� �v��
--7��5��e��D��>ɖ
--�߆�a�y�	�� -]h�4oG���}^'
--�y��Ǔ�]��炩(��68FRD���u��UK��y���^��� ���f�z/
--�
--�Ya�� J�t^��� ����������A�9/G�o5�񞽝��{/����_"����(6~���$ň�<��tx��I���'D1~�WQ�����hu�ψ\�'B6�5��}��&����.?���'��à�/���>
--�=�FX79�$���&�J�n����BvC�L�|�U�'�}nu(���C����������wzF���0��s�R�ݜJg���ڒE�10p�;@�?��E�,<����0����x�w
--P��1�� �E���v����zx��qwq�����6���Q�(�V�Ǿ�}�婼M���w���
--��sK9�����"Kx+�p���P�	�N���fT�sNUT9Ƀ��[� ~잊�ݔ��I���݊�����^=�;��0�t PKCS#8~r java.security.KeyRep$Type          xr java.lang.Enum          xpt PRIVATE
-\ No newline at end of file
-Index: src/main/java/DES3.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/src/main/java/DES3.java b/src/main/java/DES3.java
-new file mode 100644
---- /dev/null	(date 1683563461722)
-+++ b/src/main/java/DES3.java	(date 1683563461722)
-@@ -0,0 +1,23 @@
-+import javax.crypto.Cipher;
-+import javax.crypto.spec.SecretKeySpec;
-+import java.util.Arrays;
-+
-+public class DES3 {
-+    //É SUPOST SER 3DES MAS NÃO ME DEIXA CHAMAR 3DES
-+    public static byte[] encrypt(byte[] message, byte[] secretKey) throws Exception {
-+        byte[] secretKeyPadded = Arrays.copyOf(secretKey, 24); // 3DES key size is 24 bytes
-+        SecretKeySpec secretKeySpec = new SecretKeySpec(secretKeyPadded, "DESede");
-+        Cipher cipher = Cipher.getInstance("DESede/ECB/PKCS5Padding");
-+        cipher.init(Cipher.ENCRYPT_MODE, secretKeySpec);
-+        return cipher.doFinal(message);
-+    }
-+
-+    public static byte[] decrypt(byte[] message, byte[] secretKey) throws Exception {
-+        byte[] secretKeyPadded = Arrays.copyOf(secretKey, 24); // 3DES key size is 24 bytes
-+        SecretKeySpec secretKeySpec = new SecretKeySpec(secretKeyPadded, "DESede");
-+        Cipher cipher = Cipher.getInstance("DESede/ECB/PKCS5Padding");
-+        cipher.init(Cipher.DECRYPT_MODE, secretKeySpec);
-+        return cipher.doFinal(message);
-+    }
-+
-+}
-Index: Server_G11/private/privateKey.key
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>��\u0000\u0005sr\u0000\u0014java.security.KeyRep��O����C\u0002\u0000\u0004L\u0000\talgorithmt\u0000\u0012Ljava/lang/String;[\u0000\u0007encodedt\u0000\u0002[BL\u0000\u0006formatq\u0000~\u0000\u0001L\u0000\u0004typet\u0000\u001BLjava/security/KeyRep$Type;xpt\u0000\u0003RSAur\u0000\u0002[B��\u0017�\u0006\bT�\u0002\u0000\u0000xp\u0000\u0000\u0004�0�\u0004�\u0002\u0001\u00000\r\u0006\t*�H��\r\u0001\u0001\u0001\u0005\u0000\u0004�\u0004�0�\u0004�\u0002\u0001\u0000\u0002�\u0001\u0001\u0000�\u0000���\"���\u0000�A[\u0000�wGv\u0018�6\u001A��)�ƻ\"d:�\u001385��\u001B�\n�\fY*\u0001�/q�\u001E\u0000.�/�e��3���I\u001Ax\u0002��\u001E\"�H�\u0017.#'�GB\u0001�Ic�\u001A�vW50�����\u0004��ƫ��\u000E�;\u001E�)\u0016d�\u0007ؖ�3�]�ϖ���~xo��ta��%�~ MđR��arpb����){ݷ���M��\\���ddI9{\u0004bl�~��\u0007\u0000�)^a�\\�Pl�A��A��\u0018�B�#^�Oڭ�\u001B\u0014\u007FυJ.V(\f\u001DO,i�e��Q�0��ۤ��w\u0010D�>V��\u001Cd4l�\u0014��!\u0002\u0003\u0001\u0000\u0001\u0002�\u0001\u0000L֨�\u000B�Yj�\u0001\u001C^�+\u001E����\u001C�sL\u001Eq�_o2\u0004&��g�U4�,n�:r&3\u0003q���GV��\u0000-!�H��L�\u0004`l�Z�щ�^�ذ�\u0014��&��<Ǐ�8�*\u0007�#�\"5\u000Eo\u0018�;4<\u0018\tm�'TX6\u0018Ǚ����\u0017w\u0003C+�����`4���\u001B���\u0006�\u007F\u001F��8��X\u0015{��\u001F��۹�����*0�ũ�lҨ\u001E���i��=����8�\u001D�-��*�a�RB=�y�����\u0000�q�%����L�f�\ty��A�ǽ�0��\u001E\u001C�u��j:#�W����K���u�\\;\u0002��\u0000͂�~�cX�\u0006-�\u001C�f��-�'F�����A\u0001;k�=Ēv�wJVGz�C�\u0013f�Q)s\u001F5�\u0017\u0002�vxb\tRkK�u*�\u001B\u0002\u0013�JFi���M�u� ~��&��\u001DŻ����d2d��\fz\"��\u0012��\n\u0014'�\u001E�T�z�\u007F�0[�c~�s\u0002��\u0000�͞S�7��F.�!���!�\r�b�Q�K1i�2�2�G\u0019l`�����س�\u0018��\u0006R~Q�\u0017��\nI-��j�ͼx��%�@�?P9�a�k�w�XQ≣�->I.���j>��\u001E�\u00029Ď�D?sn\u0007\u0001\u0006���^�57���[N]��\u001B\u0002��\u0000�\u0002\u0004�E5D�N�W]F\u0007h*�q?�\u001BUn��M}��@��F\u0016�\r\u0007���*�Z�3�[\f���%���XÏ64l��X\u0011�֚\u0003���\u0010�����Mb����RLz\f%X\u0004���\u000F�\n;A�:��AjVM\u0005�6�\u0003%v�e�0�\u0000��\u0013�\u0011���\u0002��i�\u0001\u000BY3T`]Xh5��)\u0010!\\�����\u001F��C�r�\u0016I�r�aS�H���1���\u0018HX��E��h�2�����\u0003\u001A:T�8ָf�W����H\u0003�1-���=�N�ϸ�t\u0003�ه\u07B7=�P�)��<�,9��(\u00195�RFU\u0019�C\u001B\u0002��|m�:�\u001F4�Q�ƙ��QG<\r�-e\u001Dtv\"6��!\\��Q�Xr�;��z�Vq��r\u0003���#<�\u0016�\u001A�n\\%�Tv}��!f�\u00180�g\u0017���H�\u001Ewޏ��HT�`�r�0F��O���m\u001B�6���+0\u007F(}\u0002��\u001E/�X���ă�t\u0000\u0006PKCS#8~r\u0000\u0019java.security.KeyRep$Type\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0012\u0000\u0000xr\u0000\u000Ejava.lang.Enum\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0012\u0000\u0000xpt\u0000\u0007PRIVATE
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/Server_G11/private/privateKey.key b/Server_G11/private/privateKey.key
---- a/Server_G11/private/privateKey.key	(revision 6a82080d1e2bd7670f70553fcd8edc262ee65f0d)
-+++ b/Server_G11/private/privateKey.key	(date 1683563464903)
-@@ -1,10 +1,11 @@
- �� sr java.security.KeyRep��O����C L 	algorithmt Ljava/lang/String;[ encodedt [BL formatq ~ L typet Ljava/security/KeyRep$Type;xpt RSAur [B���T�  xp  �0�� 0
- 	*�H��
-- ��0�� � � ���"��� �A[ �wGv�6��)�ƻ"d:�85���
--�Y*�/q� .�/�e��3���Ix��"�H�.#'�GB�Ic��vW50�������ƫ���;�)d�ؖ�3�]�ϖ���~xo��ta��%�~ MđR��arpb����){ݷ���M��\���ddI9{bl�~�� �)^a�\�Pl�A��A���B�#^�Oڭ�υJ.V(O,i�e��Q�0��ۤ��wD�>V��d4l���! � L֨��Yj�^�+�����sLq�_o2&��g�U4�,n�:r&3q���GV�� -!�H��L�`l�Z�щ�^�ذ���&��<Ǐ�8�*�#�"5o�;4<	m�'TX6Ǚ����wC+�����`4���������8��X{����۹�����*0�ũ�lҨ���i��=����8��-��*�a�RB=�y����� �q�%����L�f�	y��A�ǽ�0���u��j:#�W����K���u�\;�� ͂�~�cX�-��f��-�'F�����A;k�=Ēv�wJVGz�C�f�Q)s5��vxb	RkK�u*��JFi���M�u� ~��&��Ż����d2d��z"����
--'��T�z��0[�c~�s�� �͞S�7��F.�!���!�
--�b�Q�K1i�2�2�Gl`�����س���R~Q���
--I-��j�ͼx��%�@�?P9�a�k�w�XQ≣�->I.���j>���9Ď�D?sn���^�57���[N]���� ��E5D�N�W]Fh*�q?�Un��M}��@��F�
--���*�Z�3�[���%���XÏ64l��X�֚��������Mb����RLz%X����
--;A�:��AjVM�6�%v�e�0� ��������i�Y3T`]Xh5��)!\�������C�r�I�r�aS�H���1���HX��E��h�2�����:T�8ָf�W����H�1-���=�N�ϸ�t�ه޷=�P�)��<�,9��(5�RFU�C��|m�:�4�Q�ƙ��QG<
--�-etv"6��!\��Q�Xr�;��z�Vq��r���#<���n\%�Tv}��!f�0�g���H�wޏ��HT�`�r�0F��O���m�6���+0(}��/�X���ă�t PKCS#8~r java.security.KeyRep$Type          xr java.lang.Enum          xpt PRIVATE
-\ No newline at end of file
-+ ��0�� � �ZV�ePп�w���D/�L�+�`"�l>��ה�&;��븽js+����~�����t���|hb+p>�f�yQ��ϓ^�<�w�,
-+$.S��Z'�h��p�cQypK�n,|}�y6DlǴ��X��;��<w�����ŜG)��'nJh�|@$g޳���%���o ��?��%m�a��xaW�Blj��-�d���4쪝
-+����V��3HG�5�����M�Ċ0;�ǌ�T��H;�絍��^���rͳ���{䱎� �  ������q	����7��4/CV���I�]
-+O�������# �X2��w��b#�����R�e�n	b� ޒ��H������v٦��y"h_��r��_�@�(�r�J��^B�N�+�_\3��!ܿ1A�5���{����������é�~��改7,�ˎ���h7����ү/w�
-+4HeU�D���M4�c�譖c5�^��3�wU mw�����kUE0<.��i�#��L�L����$֞�@��	X�Q�� ק�&XbP��:j As����w1
-+*��K��T�7l�4�o&�`�4
-+��7#k�ග�7{��rr�=�y�ܶП[�lW��:l�=�1{�����
-+%��d�����tt� F�|w���F�B��"��� ����Z��/!�lx����^� #� ��I�oɑ-P���R���D?��XkB�Ī��a�ݭ��6|�t*�4�Ƽ��a��SJ7�;�v�׷G��� ���@�O��B"�����9��&���u��x�<���;H�~|������F�C�ANB���H"��c�u�v�-С�?�O�����c���	��ͧ��JR����.�Y�Zw��
-+~���k& �0���*�i.�ԥ(�j�IMQ�#�/\(;%bA��?52KG&̰/ZM��O�w&,z�t�[���U|�S���7�1fG���)J����V��AUj�vOHٸ�!���-B�v����A�d/��8(�{�J>�rx ��>k�J5���K�]7��� �Z�����q�Bi*�5e�TV�Q��ǣ3يSc-oR;����/#�_�F��]Y�y�˦Ś����D�M�#3XX�K����"���tZ����ay��b;am�օ���س*�tH��k@!�E�t PKCS#8~r java.security.KeyRep$Type          xr java.lang.Enum          xpt PRIVATE
-\ No newline at end of file
-Index: server/Registry/registry.txt
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>Sara : 1\r\nStere : 1\r\n
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/server/Registry/registry.txt b/server/Registry/registry.txt
---- a/server/Registry/registry.txt	(revision 6a82080d1e2bd7670f70553fcd8edc262ee65f0d)
-+++ b/server/Registry/registry.txt	(date 1683563497544)
-@@ -1,2 +1,1 @@
- Sara : 1
--Stere : 1
Index: .idea/shelf/Uncommitted_changes_before_Update_at_08_05_2023_17_32__Changes_.xml
===================================================================
diff --git a/.idea/shelf/Uncommitted_changes_before_Update_at_08_05_2023_17_32__Changes_.xml b/.idea/shelf/Uncommitted_changes_before_Update_at_08_05_2023_17_32__Changes_.xml
deleted file mode 100644
--- a/.idea/shelf/Uncommitted_changes_before_Update_at_08_05_2023_17_32__Changes_.xml	(revision 8f48d8c6e90d40cd8299aa657e5d4687734aa5db)
+++ /dev/null	(revision 8f48d8c6e90d40cd8299aa657e5d4687734aa5db)
@@ -1,4 +0,0 @@
-<changelist name="Uncommitted_changes_before_Update_at_08_05_2023_17_32_[Changes]" date="1683563579946" recycled="true" deleted="true">
-  <option name="PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Update_at_08_05_2023_17_32_[Changes]/shelved.patch" />
-  <option name="DESCRIPTION" value="Uncommitted changes before Update at 08/05/2023 17:32 [Changes]" />
-</changelist>
\ No newline at end of file
Index: Sara/files/User_Buenas.txt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Sara/files/User_Buenas.txt b/Sara/files/User_Buenas.txt
new file mode 100644
--- /dev/null	(date 1683655288946)
+++ b/Sara/files/User_Buenas.txt	(date 1683655288946)
@@ -0,0 +1,1 @@
+Hallo
\ No newline at end of file
Index: Sara/private/privateKey.key
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Sara/private/privateKey.key b/Sara/private/privateKey.key
new file mode 100644
--- /dev/null	(date 1683658315899)
+++ b/Sara/private/privateKey.key	(date 1683658315899)
@@ -0,0 +1,13 @@
+�� sr java.security.KeyRep��O����C L 	algorithmt Ljava/lang/String;[ encodedt [BL formatq ~ L typet Ljava/security/KeyRep$Type;xpt RSAur [B���T�  xp  �0�� 0
+	*�H��
+ ��0�� � ��_R)��W�x8�b�pE�tHl��S*ȋ8�������6ج1=ۗ Tځ��Y8!6\��a�{ddd1��+�u�������iY��x�GPp?^�%~�R�ִ�������ɝ4U��1��7�һr+X��]��;��T{���+;�K���Т�%|t/D�̰[�]��bx>�|^�
+��"3�*^O��0	d��	��Wd�UU\�D������fB�7oHr�/P!�o��"�)�m��������5���h軄($>�� � )�A��1���8�p�f%�E�
+2��̴ ��F�6~�f�K6����p}7O� �33r��� K��o�&�6&I+ʟ]�� �k�.ZK��bTT}�c<iO�p2�B6;t[�3��2�K5���6���o2ҫ�
+*�Vst����
+1���PXa�����F���0�meb��7�qn!��5cF� �yX��Z���Ƒ�V^΍[�Č'���P5%����wU��V�S�T��@ӎ��#�ZQ�n��OgkKA;��� �c��k@M�~�MbLz�c5�B�s�B�����h�\��,�|��#VX�z��Ѥ�I19���Bz6��0�|TN�ȆUωI���drQg�Az�̪Q��g/!����p��Ⱦ�p��u�e���� ���)ۜ���/E��$ۃٌJ�
+�,�+z��\{��3��;9��9�3����5�����X�.�B���ӈ�ə �+���gn��'�U��D�t��%{1)r���|��u�*a�
+� �&�%�|�2����MP��U\@�56b(4�c!�3��e=��� �A�c`wfd8)]?����i*tn����T( i|~\?���Ξ_>,����U�"���G)$K�7�,>.�XF�І;e�jI_��a��٠��å�m�� �'���� ��(��H�QZ�:M�"qL��=ZQ��i�GeNY����n�?�r�l�h�$ɱZ̊
+�4�1k�?��(��F���g,br>LY--�@3j�;�����ӟ���d���VD?t�f55ȴ����'Zo�܌���h�#F�i�:��*�3>����ڇ��Xk�zZ�-�j����@�z�HhR�hDq��N��#j;�7��H��97���
+$:�PCs�5"��uIO�:��Z
+�G���t�
+��I2%t PKCS#8~r java.security.KeyRep$Type          xr java.lang.Enum          xpt PRIVATE
\ No newline at end of file
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"AutoImportSettings\">\r\n    <option name=\"autoReloadType\" value=\"SELECTIVE\" />\r\n  </component>\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"75ea87d5-b57d-45a4-9edf-2445a379a4bb\" name=\"Changes\" comment=\"add : Algoritmos de Hashing SHA-256, SHA-1 e MD5 adicionados\">\r\n      <change afterPath=\"$PROJECT_DIR$/GOOD/files/User_A.txt\" afterDir=\"false\" />\r\n      <change afterPath=\"$PROJECT_DIR$/REE/files/User_A.txt\" afterDir=\"false\" />\r\n      <change afterPath=\"$PROJECT_DIR$/REE/private/privateKey.key\" afterDir=\"false\" />\r\n      <change afterPath=\"$PROJECT_DIR$/Sara/files/User_A.txt\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/Sara/private/privateKey.key\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/Sara/private/privateKey.key\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/Server_G11/private/privateKey.key\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/Server_G11/private/privateKey.key\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/server/Registry/registry.txt\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/server/Registry/registry.txt\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/main/java/Client.java\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/src/main/java/Client.java\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/main/java/ClientHandler.java\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/src/main/java/ClientHandler.java\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/main/java/DES3.java\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/src/main/java/DES3.java\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/main/java/Hash.java\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/src/main/java/Hash.java\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/main/java/MAC.java\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/src/main/java/MAC.java\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/main/java/MainServer.java\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/src/main/java/MainServer.java\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/main/java/RequestUtils.java\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/src/main/java/RequestUtils.java\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/main/java/Server.java\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/src/main/java/Server.java\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/test/java/MACTest.java\" beforeDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"FileTemplateManagerImpl\">\r\n    <option name=\"RECENT_TEMPLATES\">\r\n      <list>\r\n        <option value=\"Class\" />\r\n      </list>\r\n    </option>\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_BRANCH_BY_REPOSITORY\">\r\n      <map>\r\n        <entry key=\"$PROJECT_DIR$\" value=\"f2039a583431f4b3711769ee1966552c536ef6d0\" />\r\n      </map>\r\n    </option>\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n  </component>\r\n  <component name=\"GitHubPullRequestSearchHistory\">{\r\n  &quot;lastFilter&quot;: {\r\n    &quot;state&quot;: &quot;OPEN&quot;\r\n  }\r\n}</component>\r\n  <component name=\"GithubPullRequestsUISettings\">\r\n    <option name=\"selectedUrlAndAccountId\">\r\n      <UrlAndAccount>\r\n        <option name=\"accountId\" value=\"d9ae9e3a-aeae-4410-8220-12bf4abc6f49\" />\r\n        <option name=\"url\" value=\"https://github.com/Blavien/GRUPO11-P2.git\" />\r\n      </UrlAndAccount>\r\n    </option>\r\n  </component>\r\n  <component name=\"MarkdownSettingsMigration\">\r\n    <option name=\"stateVersion\" value=\"1\" />\r\n  </component>\r\n  <component name=\"MavenImportPreferences\">\r\n    <option name=\"generalSettings\">\r\n      <MavenGeneralSettings>\r\n        <option name=\"useMavenConfig\" value=\"true\" />\r\n      </MavenGeneralSettings>\r\n    </option>\r\n  </component>\r\n  <component name=\"ProjectId\" id=\"2OZI9lUTFU9VIBDlzStD235WKeS\" />\r\n  <component name=\"ProjectLevelVcsManager\">\r\n    <ConfirmationsSetting value=\"2\" id=\"Add\" />\r\n  </component>\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\">{\r\n  &quot;keyToString&quot;: {\r\n    &quot;ASKED_ADD_EXTERNAL_FILES&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.OpenProjectViewOnStart&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,\r\n    &quot;ignore.virus.scanning.warn.message&quot;: &quot;true&quot;,\r\n    &quot;last_opened_file_path&quot;: &quot;C:/Users/User/Desktop/LEI 3 ANO/2 semestre/PA/GRUPO11-P2&quot;,\r\n    &quot;settings.editor.selected.configurable&quot;: &quot;reference.settings.project.maven.importing&quot;\r\n  }\r\n}</component>\r\n  <component name=\"RecentsManager\">\r\n    <key name=\"CopyFile.RECENT_KEYS\">\r\n      <recent name=\"C:\\Users\\User\\Desktop\\LEI 3 ANO\\2 semestre\\PA\\GRUPO11-P2\\AAAEAEA\" />\r\n      <recent name=\"C:\\Users\\User\\Desktop\\LEI 3 ANO\\2 semestre\\PA\\GRUPO11-P2\\AAD\" />\r\n      <recent name=\"C:\\Users\\User\\Desktop\\LEI 3 ANO\\2 semestre\\PA\\GRUPO11-P2\\ANN\" />\r\n      <recent name=\"C:\\Users\\User\\Desktop\\LEI 3 ANO\\2 semestre\\PA\\GRUPO11-P2\\FER\" />\r\n      <recent name=\"C:\\Users\\User\\Desktop\\LEI 3 ANO\\2 semestre\\PA\\GRUPO11-P2\\FRE\" />\r\n    </key>\r\n    <key name=\"MoveFile.RECENT_KEYS\">\r\n      <recent name=\"C:\\Users\\User\\Desktop\\LEI 3 ANO\\2 semestre\\PA\\GRUPO11-P2\\server\" />\r\n      <recent name=\"C:\\Users\\User\\Desktop\\LEI 3 ANO\\2 semestre\\PA\\GRUPO11-P2\\server\\files\\Registry\" />\r\n      <recent name=\"C:\\Users\\User\\Desktop\\LEI 3 ANO\\2 semestre\\PA\\GRUPO11-P2\" />\r\n    </key>\r\n    <key name=\"ExtractSuperBase.RECENT_KEYS\">\r\n      <recent name=\"\" />\r\n    </key>\r\n  </component>\r\n  <component name=\"RunManager\" selected=\"Application.Client\">\r\n    <configuration name=\"Client\" type=\"Application\" factoryName=\"Application\">\r\n      <option name=\"MAIN_CLASS_NAME\" value=\"MainClient\" />\r\n      <module name=\"text-file-server\" />\r\n      <method v=\"2\">\r\n        <option name=\"Make\" enabled=\"true\" />\r\n      </method>\r\n    </configuration>\r\n    <configuration name=\"Server\" type=\"Application\" factoryName=\"Application\">\r\n      <option name=\"MAIN_CLASS_NAME\" value=\"MainServer\" />\r\n      <module name=\"text-file-server\" />\r\n      <method v=\"2\">\r\n        <option name=\"Make\" enabled=\"true\" />\r\n      </method>\r\n    </configuration>\r\n    <configuration default=\"true\" type=\"JetRunConfigurationType\">\r\n      <module name=\"GRUPO11-P2\" />\r\n      <method v=\"2\">\r\n        <option name=\"Make\" enabled=\"true\" />\r\n      </method>\r\n    </configuration>\r\n    <configuration default=\"true\" type=\"KotlinStandaloneScriptRunConfigurationType\">\r\n      <module name=\"GRUPO11-P2\" />\r\n      <option name=\"filePath\" />\r\n      <method v=\"2\">\r\n        <option name=\"Make\" enabled=\"true\" />\r\n      </method>\r\n    </configuration>\r\n    <list>\r\n      <item itemvalue=\"Application.Server\" />\r\n      <item itemvalue=\"Application.Client\" />\r\n    </list>\r\n  </component>\r\n  <component name=\"SpellCheckerSettings\" RuntimeDictionaries=\"0\" Folders=\"0\" CustomDictionaries=\"0\" DefaultDictionary=\"application-level\" UseSingleDictionary=\"true\" transferred=\"true\" />\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"75ea87d5-b57d-45a4-9edf-2445a379a4bb\" name=\"Changes\" comment=\"\" />\r\n      <created>1681761527297</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1681761527297</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00001\" summary=\"add: Base project\">\r\n      <created>1681761625948</created>\r\n      <option name=\"number\" value=\"00001\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00001\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1681761625948</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00002\" summary=\"Fix: Structure of project\">\r\n      <created>1681761733271</created>\r\n      <option name=\"number\" value=\"00002\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00002\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1681761733271</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00003\" summary=\"add: Encrytion/Decryption Algorithms added - AES, RSA, HMACSHA256, Diffie-Hellman, ByteUtils for byte[] manipulation.\">\r\n      <created>1681893641084</created>\r\n      <option name=\"number\" value=\"00003\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00003\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1681893641084</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00004\" summary=\"&lt;feat&gt; (RSA,Client) :  Requisito 2.1 feito. Geração das keyPairs e armazenamento das mesmas. Teste feito nas chaves e estão correctas.\">\r\n      <created>1682268205147</created>\r\n      <option name=\"number\" value=\"00004\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00004\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1682268205147</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00005\" summary=\"&lt;feat&gt; (MAC, Digest) :  Geração de chaves únicas, Criação de um HashMap para manter registo dos requests dos clientes\">\r\n      <created>1682280876713</created>\r\n      <option name=\"number\" value=\"00005\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00005\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1682280876713</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00006\" summary=\"&lt;fix&gt; (RSA) : Correção do nome das chaves públicas\">\r\n      <created>1682281333854</created>\r\n      <option name=\"number\" value=\"00006\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00006\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1682281333854</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00007\" summary=\"&lt;feat&gt; (RSA) : Armazenamento das chaves do servidor\">\r\n      <created>1682422326566</created>\r\n      <option name=\"number\" value=\"00007\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00007\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1682422326566</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00008\" summary=\"&lt;feat&gt; (Server, Requests, Registry) : Adicionada uma maneira de saber qual o utilizador que fez o request e como manter registo do número de requests\">\r\n      <created>1682445150617</created>\r\n      <option name=\"number\" value=\"00008\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00008\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1682445150618</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00009\" summary=\"&lt;fix&gt; (ClientHandler,RequestsUtils) : Movido o código que estava a gerir os requests no ClientHandler para o RequestUtils\">\r\n      <created>1682496666117</created>\r\n      <option name=\"number\" value=\"00009\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00009\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1682496666117</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00010\" summary=\"&lt;fix&gt; (Server,RequestsUtils) : Code clean up, alterado o valor do contador de requests para 0 invés de 1\">\r\n      <created>1682497724289</created>\r\n      <option name=\"number\" value=\"00010\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00010\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1682497724289</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00011\" summary=\"&lt;fix&gt; (Server) :\">\r\n      <created>1682950676063</created>\r\n      <option name=\"number\" value=\"00011\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00011\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1682950676063</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00012\" summary=\"&lt;add&gt; (Server) : Registry\">\r\n      <created>1682951038068</created>\r\n      <option name=\"number\" value=\"00012\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00012\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1682951038068</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00013\" summary=\"&lt;add&gt; (Client) : Sessões etão implementadas, e o cliente é obrigado a iniciar a sessão de novo para continuar a pedir ficheiros\">\r\n      <created>1682954743405</created>\r\n      <option name=\"number\" value=\"00013\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00013\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1682954743405</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00014\" summary=\"merge 2\">\r\n      <created>1683369397578</created>\r\n      <option name=\"number\" value=\"00014\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00014\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1683369397578</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00015\" summary=\"Controlo de Sessões não está a funcionar, mas esta versão funciona ligeriamente\">\r\n      <created>1683410000968</created>\r\n      <option name=\"number\" value=\"00015\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00015\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1683410000968</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00016\" summary=\"feat : Sessões implementadas corretamente.\">\r\n      <created>1683490372429</created>\r\n      <option name=\"number\" value=\"00016\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00016\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1683490372429</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00017\" summary=\"feat : add client code\">\r\n      <created>1683490444909</created>\r\n      <option name=\"number\" value=\"00017\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00017\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1683490444909</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00018\" summary=\"Código feito pelo professor Diogo Freitas\">\r\n      <created>1683542047228</created>\r\n      <option name=\"number\" value=\"00018\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00018\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1683542047228</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00019\" summary=\"Código feito pelo professor Diogo Freitas\">\r\n      <created>1683542214418</created>\r\n      <option name=\"number\" value=\"00019\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00019\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1683542214418</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00020\" summary=\"feat : Partilha da chave MAC entre client e clientHandler. Code cleanup\">\r\n      <created>1683546047474</created>\r\n      <option name=\"number\" value=\"00020\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00020\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1683546047474</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00021\" summary=\"fix : Correção do funcionamento do mainClient, e adição de código para a prevençao de casos indesejáveis, como a posibilidade de criar um novo cliente com um username 'Sara', quando já existe este cliente 'Sara'\">\r\n      <created>1683549577972</created>\r\n      <option name=\"number\" value=\"00021\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00021\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1683549577972</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00022\" summary=\"add : Requisito extra em desenvolvimento\">\r\n      <created>1683554945821</created>\r\n      <option name=\"number\" value=\"00022\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00022\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1683554945821</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00023\" summary=\"add : Requisito extra - MAC e AES funcionam corretamente\">\r\n      <created>1683556446979</created>\r\n      <option name=\"number\" value=\"00023\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00023\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1683556446979</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00024\" summary=\"feat : Requisito extra - DES e HASH - SHA-512 a funcionar\">\r\n      <created>1683562618370</created>\r\n      <option name=\"number\" value=\"00024\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00024\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1683562618370</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00025\" summary=\"feat : Requisito extra - Adicionei o 3DES\">\r\n      <created>1683563634737</created>\r\n      <option name=\"number\" value=\"00025\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00025\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1683563634737</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00026\" summary=\"fix : working\">\r\n      <created>1683564825571</created>\r\n      <option name=\"number\" value=\"00026\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00026\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1683564825571</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00027\" summary=\"add : Algoritmos de Hashing SHA-256, SHA-1 e MD5 adicionados\">\r\n      <created>1683567453619</created>\r\n      <option name=\"number\" value=\"00027\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00027\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1683567453619</updated>\r\n    </task>\r\n    <option name=\"localTasksCounter\" value=\"28\" />\r\n    <servers />\r\n  </component>\r\n  <component name=\"Vcs.Log.Tabs.Properties\">\r\n    <option name=\"TAB_STATES\">\r\n      <map>\r\n        <entry key=\"MAIN\">\r\n          <value>\r\n            <State>\r\n              <option name=\"FILTERS\">\r\n                <map>\r\n                  <entry key=\"branch\">\r\n                    <value>\r\n                      <list>\r\n                        <option value=\"dev-Felicidade\" />\r\n                      </list>\r\n                    </value>\r\n                  </entry>\r\n                </map>\r\n              </option>\r\n            </State>\r\n          </value>\r\n        </entry>\r\n      </map>\r\n    </option>\r\n  </component>\r\n  <component name=\"VcsManagerConfiguration\">\r\n    <option name=\"ADD_EXTERNAL_FILES_SILENTLY\" value=\"true\" />\r\n    <MESSAGE value=\"add: Encrytion/Decryption Algorithms added - AES, RSA, HMACSHA256, Diffie-Hellman, ByteUtils for byte[] manipulation.\" />\r\n    <MESSAGE value=\"&lt;feat&gt; (RSA,Client) :  Requisito 2.1 feito. Geração das keyPairs e armazenamento das mesmas. Teste feito nas chaves e estão correctas.\" />\r\n    <MESSAGE value=\"&lt;feat&gt; (MAC, Digest) :  Geração de chaves únicas, Criação de um HashMap para manter registo dos requests dos clientes\" />\r\n    <MESSAGE value=\"&lt;fix&gt; (RSA) : Correção do nome das chaves públicas\" />\r\n    <MESSAGE value=\"&lt;feat&gt; (RSA) : Armazenamento das chaves do servidor\" />\r\n    <MESSAGE value=\"&lt;feat&gt; (Server, Requests, Registry) : Adicionada uma maneira de saber qual o utilizador que fez o request e como manter registo do número de requests\" />\r\n    <MESSAGE value=\"&lt;fix&gt; (ClientHandler,RequestsUtils) : Movido o código que estava a gerir os requests no ClientHandler para o RequestUtils\" />\r\n    <MESSAGE value=\"&lt;fix&gt; (Server,RequestsUtils) : Code clean up, alterado o valor do contador de requests para 0 invés de 1\" />\r\n    <MESSAGE value=\"&lt;fix&gt; (Server) :\" />\r\n    <MESSAGE value=\"&lt;add&gt; (Server) : Registry\" />\r\n    <MESSAGE value=\"&lt;add&gt; (Client) : Sessões etão implementadas, e o cliente é obrigado a iniciar a sessão de novo para continuar a pedir ficheiros\" />\r\n    <MESSAGE value=\"merge: dev-Sara &amp; dev-AndreGois\" />\r\n    <MESSAGE value=\"merge 2\" />\r\n    <MESSAGE value=\"Controlo de Sessões não está a funcionar, mas esta versão funciona ligeriamente\" />\r\n    <MESSAGE value=\"feat : Sessões implementadas corretamente.\" />\r\n    <MESSAGE value=\"feat : add client code\" />\r\n    <MESSAGE value=\"Código feito pelo professor Diogo Freitas\" />\r\n    <MESSAGE value=\"feat : Partilha da chave MAC entre client e clientHandler. Code cleanup\" />\r\n    <MESSAGE value=\"fix : Correção do funcionamento do mainClient, e adição de código para a prevençao de casos indesejáveis, como a posibilidade de criar um novo cliente com um username 'Sara', quando já existe este cliente 'Sara'\" />\r\n    <MESSAGE value=\"add : Requisito extra em desenvolvimento\" />\r\n    <MESSAGE value=\"add : Requisito extra - MAC e AES funcionam corretamente\" />\r\n    <MESSAGE value=\"feat : Requisito extra - DES e HASH - SHA-512 a funcionar\" />\r\n    <MESSAGE value=\"feat : Requisito extra - Adicionei o 3DES\" />\r\n    <MESSAGE value=\"fix : working\" />\r\n    <MESSAGE value=\"add : Algoritmos de Hashing SHA-256, SHA-1 e MD5 adicionados\" />\r\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"add : Algoritmos de Hashing SHA-256, SHA-1 e MD5 adicionados\" />\r\n  </component>\r\n  <component name=\"XDebuggerManager\">\r\n    <breakpoint-manager>\r\n      <breakpoints>\r\n        <breakpoint enabled=\"true\" type=\"java-exception\">\r\n          <properties class=\"java.lang.RuntimeException\" package=\"java.lang\" />\r\n          <option name=\"timeStamp\" value=\"2\" />\r\n        </breakpoint>\r\n      </breakpoints>\r\n    </breakpoint-manager>\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision 8f48d8c6e90d40cd8299aa657e5d4687734aa5db)
+++ b/.idea/workspace.xml	(date 1683712768006)
@@ -1,121 +1,12 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <project version="4">
-  <component name="AutoImportSettings">
-    <option name="autoReloadType" value="SELECTIVE" />
-  </component>
-  <component name="ChangeListManager">
-    <list default="true" id="75ea87d5-b57d-45a4-9edf-2445a379a4bb" name="Changes" comment="add : Algoritmos de Hashing SHA-256, SHA-1 e MD5 adicionados">
-      <change afterPath="$PROJECT_DIR$/GOOD/files/User_A.txt" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/REE/files/User_A.txt" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/REE/private/privateKey.key" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/Sara/files/User_A.txt" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/Sara/private/privateKey.key" beforeDir="false" afterPath="$PROJECT_DIR$/Sara/private/privateKey.key" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/Server_G11/private/privateKey.key" beforeDir="false" afterPath="$PROJECT_DIR$/Server_G11/private/privateKey.key" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/server/Registry/registry.txt" beforeDir="false" afterPath="$PROJECT_DIR$/server/Registry/registry.txt" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/src/main/java/Client.java" beforeDir="false" afterPath="$PROJECT_DIR$/src/main/java/Client.java" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/src/main/java/ClientHandler.java" beforeDir="false" afterPath="$PROJECT_DIR$/src/main/java/ClientHandler.java" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/src/main/java/DES3.java" beforeDir="false" afterPath="$PROJECT_DIR$/src/main/java/DES3.java" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/src/main/java/Hash.java" beforeDir="false" afterPath="$PROJECT_DIR$/src/main/java/Hash.java" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/src/main/java/MAC.java" beforeDir="false" afterPath="$PROJECT_DIR$/src/main/java/MAC.java" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/src/main/java/MainServer.java" beforeDir="false" afterPath="$PROJECT_DIR$/src/main/java/MainServer.java" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/src/main/java/RequestUtils.java" beforeDir="false" afterPath="$PROJECT_DIR$/src/main/java/RequestUtils.java" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/src/main/java/Server.java" beforeDir="false" afterPath="$PROJECT_DIR$/src/main/java/Server.java" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/src/test/java/MACTest.java" beforeDir="false" />
-    </list>
-    <option name="SHOW_DIALOG" value="false" />
-    <option name="HIGHLIGHT_CONFLICTS" value="true" />
-    <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
-    <option name="LAST_RESOLUTION" value="IGNORE" />
-  </component>
-  <component name="FileTemplateManagerImpl">
-    <option name="RECENT_TEMPLATES">
-      <list>
-        <option value="Class" />
-      </list>
-    </option>
-  </component>
-  <component name="Git.Settings">
-    <option name="RECENT_BRANCH_BY_REPOSITORY">
-      <map>
-        <entry key="$PROJECT_DIR$" value="f2039a583431f4b3711769ee1966552c536ef6d0" />
-      </map>
-    </option>
-    <option name="RECENT_GIT_ROOT_PATH" value="$PROJECT_DIR$" />
-  </component>
-  <component name="GitHubPullRequestSearchHistory">{
-  &quot;lastFilter&quot;: {
-    &quot;state&quot;: &quot;OPEN&quot;
-  }
-}</component>
-  <component name="GithubPullRequestsUISettings">
-    <option name="selectedUrlAndAccountId">
-      <UrlAndAccount>
-        <option name="accountId" value="d9ae9e3a-aeae-4410-8220-12bf4abc6f49" />
-        <option name="url" value="https://github.com/Blavien/GRUPO11-P2.git" />
-      </UrlAndAccount>
-    </option>
-  </component>
-  <component name="MarkdownSettingsMigration">
-    <option name="stateVersion" value="1" />
-  </component>
-  <component name="MavenImportPreferences">
-    <option name="generalSettings">
-      <MavenGeneralSettings>
-        <option name="useMavenConfig" value="true" />
-      </MavenGeneralSettings>
-    </option>
-  </component>
-  <component name="ProjectId" id="2OZI9lUTFU9VIBDlzStD235WKeS" />
-  <component name="ProjectLevelVcsManager">
-    <ConfirmationsSetting value="2" id="Add" />
-  </component>
-  <component name="ProjectViewState">
-    <option name="hideEmptyMiddlePackages" value="true" />
-    <option name="showLibraryContents" value="true" />
-  </component>
   <component name="PropertiesComponent">{
   &quot;keyToString&quot;: {
-    &quot;ASKED_ADD_EXTERNAL_FILES&quot;: &quot;true&quot;,
-    &quot;RunOnceActivity.OpenProjectViewOnStart&quot;: &quot;true&quot;,
-    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,
-    &quot;ignore.virus.scanning.warn.message&quot;: &quot;true&quot;,
-    &quot;last_opened_file_path&quot;: &quot;C:/Users/User/Desktop/LEI 3 ANO/2 semestre/PA/GRUPO11-P2&quot;,
-    &quot;settings.editor.selected.configurable&quot;: &quot;reference.settings.project.maven.importing&quot;
+    &quot;last_opened_file_path&quot;: &quot;C:/Users/User/Desktop/LEI 3 ANO/2 semestre/PA/TP3&quot;,
+    &quot;settings.editor.selected.configurable&quot;: &quot;project.propVCSSupport.Mappings&quot;
   }
 }</component>
-  <component name="RecentsManager">
-    <key name="CopyFile.RECENT_KEYS">
-      <recent name="C:\Users\User\Desktop\LEI 3 ANO\2 semestre\PA\GRUPO11-P2\AAAEAEA" />
-      <recent name="C:\Users\User\Desktop\LEI 3 ANO\2 semestre\PA\GRUPO11-P2\AAD" />
-      <recent name="C:\Users\User\Desktop\LEI 3 ANO\2 semestre\PA\GRUPO11-P2\ANN" />
-      <recent name="C:\Users\User\Desktop\LEI 3 ANO\2 semestre\PA\GRUPO11-P2\FER" />
-      <recent name="C:\Users\User\Desktop\LEI 3 ANO\2 semestre\PA\GRUPO11-P2\FRE" />
-    </key>
-    <key name="MoveFile.RECENT_KEYS">
-      <recent name="C:\Users\User\Desktop\LEI 3 ANO\2 semestre\PA\GRUPO11-P2\server" />
-      <recent name="C:\Users\User\Desktop\LEI 3 ANO\2 semestre\PA\GRUPO11-P2\server\files\Registry" />
-      <recent name="C:\Users\User\Desktop\LEI 3 ANO\2 semestre\PA\GRUPO11-P2" />
-    </key>
-    <key name="ExtractSuperBase.RECENT_KEYS">
-      <recent name="" />
-    </key>
-  </component>
-  <component name="RunManager" selected="Application.Client">
-    <configuration name="Client" type="Application" factoryName="Application">
-      <option name="MAIN_CLASS_NAME" value="MainClient" />
-      <module name="text-file-server" />
-      <method v="2">
-        <option name="Make" enabled="true" />
-      </method>
-    </configuration>
-    <configuration name="Server" type="Application" factoryName="Application">
-      <option name="MAIN_CLASS_NAME" value="MainServer" />
-      <module name="text-file-server" />
-      <method v="2">
-        <option name="Make" enabled="true" />
-      </method>
-    </configuration>
+  <component name="RunManager">
     <configuration default="true" type="JetRunConfigurationType">
       <module name="GRUPO11-P2" />
       <method v="2">
@@ -129,272 +20,5 @@
         <option name="Make" enabled="true" />
       </method>
     </configuration>
-    <list>
-      <item itemvalue="Application.Server" />
-      <item itemvalue="Application.Client" />
-    </list>
-  </component>
-  <component name="SpellCheckerSettings" RuntimeDictionaries="0" Folders="0" CustomDictionaries="0" DefaultDictionary="application-level" UseSingleDictionary="true" transferred="true" />
-  <component name="TaskManager">
-    <task active="true" id="Default" summary="Default task">
-      <changelist id="75ea87d5-b57d-45a4-9edf-2445a379a4bb" name="Changes" comment="" />
-      <created>1681761527297</created>
-      <option name="number" value="Default" />
-      <option name="presentableId" value="Default" />
-      <updated>1681761527297</updated>
-    </task>
-    <task id="LOCAL-00001" summary="add: Base project">
-      <created>1681761625948</created>
-      <option name="number" value="00001" />
-      <option name="presentableId" value="LOCAL-00001" />
-      <option name="project" value="LOCAL" />
-      <updated>1681761625948</updated>
-    </task>
-    <task id="LOCAL-00002" summary="Fix: Structure of project">
-      <created>1681761733271</created>
-      <option name="number" value="00002" />
-      <option name="presentableId" value="LOCAL-00002" />
-      <option name="project" value="LOCAL" />
-      <updated>1681761733271</updated>
-    </task>
-    <task id="LOCAL-00003" summary="add: Encrytion/Decryption Algorithms added - AES, RSA, HMACSHA256, Diffie-Hellman, ByteUtils for byte[] manipulation.">
-      <created>1681893641084</created>
-      <option name="number" value="00003" />
-      <option name="presentableId" value="LOCAL-00003" />
-      <option name="project" value="LOCAL" />
-      <updated>1681893641084</updated>
-    </task>
-    <task id="LOCAL-00004" summary="&lt;feat&gt; (RSA,Client) :  Requisito 2.1 feito. Geração das keyPairs e armazenamento das mesmas. Teste feito nas chaves e estão correctas.">
-      <created>1682268205147</created>
-      <option name="number" value="00004" />
-      <option name="presentableId" value="LOCAL-00004" />
-      <option name="project" value="LOCAL" />
-      <updated>1682268205147</updated>
-    </task>
-    <task id="LOCAL-00005" summary="&lt;feat&gt; (MAC, Digest) :  Geração de chaves únicas, Criação de um HashMap para manter registo dos requests dos clientes">
-      <created>1682280876713</created>
-      <option name="number" value="00005" />
-      <option name="presentableId" value="LOCAL-00005" />
-      <option name="project" value="LOCAL" />
-      <updated>1682280876713</updated>
-    </task>
-    <task id="LOCAL-00006" summary="&lt;fix&gt; (RSA) : Correção do nome das chaves públicas">
-      <created>1682281333854</created>
-      <option name="number" value="00006" />
-      <option name="presentableId" value="LOCAL-00006" />
-      <option name="project" value="LOCAL" />
-      <updated>1682281333854</updated>
-    </task>
-    <task id="LOCAL-00007" summary="&lt;feat&gt; (RSA) : Armazenamento das chaves do servidor">
-      <created>1682422326566</created>
-      <option name="number" value="00007" />
-      <option name="presentableId" value="LOCAL-00007" />
-      <option name="project" value="LOCAL" />
-      <updated>1682422326566</updated>
-    </task>
-    <task id="LOCAL-00008" summary="&lt;feat&gt; (Server, Requests, Registry) : Adicionada uma maneira de saber qual o utilizador que fez o request e como manter registo do número de requests">
-      <created>1682445150617</created>
-      <option name="number" value="00008" />
-      <option name="presentableId" value="LOCAL-00008" />
-      <option name="project" value="LOCAL" />
-      <updated>1682445150618</updated>
-    </task>
-    <task id="LOCAL-00009" summary="&lt;fix&gt; (ClientHandler,RequestsUtils) : Movido o código que estava a gerir os requests no ClientHandler para o RequestUtils">
-      <created>1682496666117</created>
-      <option name="number" value="00009" />
-      <option name="presentableId" value="LOCAL-00009" />
-      <option name="project" value="LOCAL" />
-      <updated>1682496666117</updated>
-    </task>
-    <task id="LOCAL-00010" summary="&lt;fix&gt; (Server,RequestsUtils) : Code clean up, alterado o valor do contador de requests para 0 invés de 1">
-      <created>1682497724289</created>
-      <option name="number" value="00010" />
-      <option name="presentableId" value="LOCAL-00010" />
-      <option name="project" value="LOCAL" />
-      <updated>1682497724289</updated>
-    </task>
-    <task id="LOCAL-00011" summary="&lt;fix&gt; (Server) :">
-      <created>1682950676063</created>
-      <option name="number" value="00011" />
-      <option name="presentableId" value="LOCAL-00011" />
-      <option name="project" value="LOCAL" />
-      <updated>1682950676063</updated>
-    </task>
-    <task id="LOCAL-00012" summary="&lt;add&gt; (Server) : Registry">
-      <created>1682951038068</created>
-      <option name="number" value="00012" />
-      <option name="presentableId" value="LOCAL-00012" />
-      <option name="project" value="LOCAL" />
-      <updated>1682951038068</updated>
-    </task>
-    <task id="LOCAL-00013" summary="&lt;add&gt; (Client) : Sessões etão implementadas, e o cliente é obrigado a iniciar a sessão de novo para continuar a pedir ficheiros">
-      <created>1682954743405</created>
-      <option name="number" value="00013" />
-      <option name="presentableId" value="LOCAL-00013" />
-      <option name="project" value="LOCAL" />
-      <updated>1682954743405</updated>
-    </task>
-    <task id="LOCAL-00014" summary="merge 2">
-      <created>1683369397578</created>
-      <option name="number" value="00014" />
-      <option name="presentableId" value="LOCAL-00014" />
-      <option name="project" value="LOCAL" />
-      <updated>1683369397578</updated>
-    </task>
-    <task id="LOCAL-00015" summary="Controlo de Sessões não está a funcionar, mas esta versão funciona ligeriamente">
-      <created>1683410000968</created>
-      <option name="number" value="00015" />
-      <option name="presentableId" value="LOCAL-00015" />
-      <option name="project" value="LOCAL" />
-      <updated>1683410000968</updated>
-    </task>
-    <task id="LOCAL-00016" summary="feat : Sessões implementadas corretamente.">
-      <created>1683490372429</created>
-      <option name="number" value="00016" />
-      <option name="presentableId" value="LOCAL-00016" />
-      <option name="project" value="LOCAL" />
-      <updated>1683490372429</updated>
-    </task>
-    <task id="LOCAL-00017" summary="feat : add client code">
-      <created>1683490444909</created>
-      <option name="number" value="00017" />
-      <option name="presentableId" value="LOCAL-00017" />
-      <option name="project" value="LOCAL" />
-      <updated>1683490444909</updated>
-    </task>
-    <task id="LOCAL-00018" summary="Código feito pelo professor Diogo Freitas">
-      <created>1683542047228</created>
-      <option name="number" value="00018" />
-      <option name="presentableId" value="LOCAL-00018" />
-      <option name="project" value="LOCAL" />
-      <updated>1683542047228</updated>
-    </task>
-    <task id="LOCAL-00019" summary="Código feito pelo professor Diogo Freitas">
-      <created>1683542214418</created>
-      <option name="number" value="00019" />
-      <option name="presentableId" value="LOCAL-00019" />
-      <option name="project" value="LOCAL" />
-      <updated>1683542214418</updated>
-    </task>
-    <task id="LOCAL-00020" summary="feat : Partilha da chave MAC entre client e clientHandler. Code cleanup">
-      <created>1683546047474</created>
-      <option name="number" value="00020" />
-      <option name="presentableId" value="LOCAL-00020" />
-      <option name="project" value="LOCAL" />
-      <updated>1683546047474</updated>
-    </task>
-    <task id="LOCAL-00021" summary="fix : Correção do funcionamento do mainClient, e adição de código para a prevençao de casos indesejáveis, como a posibilidade de criar um novo cliente com um username 'Sara', quando já existe este cliente 'Sara'">
-      <created>1683549577972</created>
-      <option name="number" value="00021" />
-      <option name="presentableId" value="LOCAL-00021" />
-      <option name="project" value="LOCAL" />
-      <updated>1683549577972</updated>
-    </task>
-    <task id="LOCAL-00022" summary="add : Requisito extra em desenvolvimento">
-      <created>1683554945821</created>
-      <option name="number" value="00022" />
-      <option name="presentableId" value="LOCAL-00022" />
-      <option name="project" value="LOCAL" />
-      <updated>1683554945821</updated>
-    </task>
-    <task id="LOCAL-00023" summary="add : Requisito extra - MAC e AES funcionam corretamente">
-      <created>1683556446979</created>
-      <option name="number" value="00023" />
-      <option name="presentableId" value="LOCAL-00023" />
-      <option name="project" value="LOCAL" />
-      <updated>1683556446979</updated>
-    </task>
-    <task id="LOCAL-00024" summary="feat : Requisito extra - DES e HASH - SHA-512 a funcionar">
-      <created>1683562618370</created>
-      <option name="number" value="00024" />
-      <option name="presentableId" value="LOCAL-00024" />
-      <option name="project" value="LOCAL" />
-      <updated>1683562618370</updated>
-    </task>
-    <task id="LOCAL-00025" summary="feat : Requisito extra - Adicionei o 3DES">
-      <created>1683563634737</created>
-      <option name="number" value="00025" />
-      <option name="presentableId" value="LOCAL-00025" />
-      <option name="project" value="LOCAL" />
-      <updated>1683563634737</updated>
-    </task>
-    <task id="LOCAL-00026" summary="fix : working">
-      <created>1683564825571</created>
-      <option name="number" value="00026" />
-      <option name="presentableId" value="LOCAL-00026" />
-      <option name="project" value="LOCAL" />
-      <updated>1683564825571</updated>
-    </task>
-    <task id="LOCAL-00027" summary="add : Algoritmos de Hashing SHA-256, SHA-1 e MD5 adicionados">
-      <created>1683567453619</created>
-      <option name="number" value="00027" />
-      <option name="presentableId" value="LOCAL-00027" />
-      <option name="project" value="LOCAL" />
-      <updated>1683567453619</updated>
-    </task>
-    <option name="localTasksCounter" value="28" />
-    <servers />
-  </component>
-  <component name="Vcs.Log.Tabs.Properties">
-    <option name="TAB_STATES">
-      <map>
-        <entry key="MAIN">
-          <value>
-            <State>
-              <option name="FILTERS">
-                <map>
-                  <entry key="branch">
-                    <value>
-                      <list>
-                        <option value="dev-Felicidade" />
-                      </list>
-                    </value>
-                  </entry>
-                </map>
-              </option>
-            </State>
-          </value>
-        </entry>
-      </map>
-    </option>
-  </component>
-  <component name="VcsManagerConfiguration">
-    <option name="ADD_EXTERNAL_FILES_SILENTLY" value="true" />
-    <MESSAGE value="add: Encrytion/Decryption Algorithms added - AES, RSA, HMACSHA256, Diffie-Hellman, ByteUtils for byte[] manipulation." />
-    <MESSAGE value="&lt;feat&gt; (RSA,Client) :  Requisito 2.1 feito. Geração das keyPairs e armazenamento das mesmas. Teste feito nas chaves e estão correctas." />
-    <MESSAGE value="&lt;feat&gt; (MAC, Digest) :  Geração de chaves únicas, Criação de um HashMap para manter registo dos requests dos clientes" />
-    <MESSAGE value="&lt;fix&gt; (RSA) : Correção do nome das chaves públicas" />
-    <MESSAGE value="&lt;feat&gt; (RSA) : Armazenamento das chaves do servidor" />
-    <MESSAGE value="&lt;feat&gt; (Server, Requests, Registry) : Adicionada uma maneira de saber qual o utilizador que fez o request e como manter registo do número de requests" />
-    <MESSAGE value="&lt;fix&gt; (ClientHandler,RequestsUtils) : Movido o código que estava a gerir os requests no ClientHandler para o RequestUtils" />
-    <MESSAGE value="&lt;fix&gt; (Server,RequestsUtils) : Code clean up, alterado o valor do contador de requests para 0 invés de 1" />
-    <MESSAGE value="&lt;fix&gt; (Server) :" />
-    <MESSAGE value="&lt;add&gt; (Server) : Registry" />
-    <MESSAGE value="&lt;add&gt; (Client) : Sessões etão implementadas, e o cliente é obrigado a iniciar a sessão de novo para continuar a pedir ficheiros" />
-    <MESSAGE value="merge: dev-Sara &amp; dev-AndreGois" />
-    <MESSAGE value="merge 2" />
-    <MESSAGE value="Controlo de Sessões não está a funcionar, mas esta versão funciona ligeriamente" />
-    <MESSAGE value="feat : Sessões implementadas corretamente." />
-    <MESSAGE value="feat : add client code" />
-    <MESSAGE value="Código feito pelo professor Diogo Freitas" />
-    <MESSAGE value="feat : Partilha da chave MAC entre client e clientHandler. Code cleanup" />
-    <MESSAGE value="fix : Correção do funcionamento do mainClient, e adição de código para a prevençao de casos indesejáveis, como a posibilidade de criar um novo cliente com um username 'Sara', quando já existe este cliente 'Sara'" />
-    <MESSAGE value="add : Requisito extra em desenvolvimento" />
-    <MESSAGE value="add : Requisito extra - MAC e AES funcionam corretamente" />
-    <MESSAGE value="feat : Requisito extra - DES e HASH - SHA-512 a funcionar" />
-    <MESSAGE value="feat : Requisito extra - Adicionei o 3DES" />
-    <MESSAGE value="fix : working" />
-    <MESSAGE value="add : Algoritmos de Hashing SHA-256, SHA-1 e MD5 adicionados" />
-    <option name="LAST_COMMIT_MESSAGE" value="add : Algoritmos de Hashing SHA-256, SHA-1 e MD5 adicionados" />
-  </component>
-  <component name="XDebuggerManager">
-    <breakpoint-manager>
-      <breakpoints>
-        <breakpoint enabled="true" type="java-exception">
-          <properties class="java.lang.RuntimeException" package="java.lang" />
-          <option name="timeStamp" value="2" />
-        </breakpoint>
-      </breakpoints>
-    </breakpoint-manager>
   </component>
 </project>
\ No newline at end of file
Index: server/Registry/registry.txt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>Sara : 2\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/server/Registry/registry.txt b/server/Registry/registry.txt
--- a/server/Registry/registry.txt	(revision 8f48d8c6e90d40cd8299aa657e5d4687734aa5db)
+++ b/server/Registry/registry.txt	(date 1683658317517)
@@ -1,1 +1,1 @@
-Sara : 2
+Sara : 0
Index: Server_G11/private/privateKey.key
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>��\u0000\u0005sr\u0000\u0014java.security.KeyRep��O����C\u0002\u0000\u0004L\u0000\talgorithmt\u0000\u0012Ljava/lang/String;[\u0000\u0007encodedt\u0000\u0002[BL\u0000\u0006formatq\u0000~\u0000\u0001L\u0000\u0004typet\u0000\u001BLjava/security/KeyRep$Type;xpt\u0000\u0003RSAur\u0000\u0002[B��\u0017�\u0006\bT�\u0002\u0000\u0000xp\u0000\u0000\u0004�0�\u0004�\u0002\u0001\u00000\r\u0006\t*�H��\r\u0001\u0001\u0001\u0005\u0000\u0004�\u0004�0�\u0004�\u0002\u0001\u0000\u0002�\u0001\u0001\u0000�b\u0006z��[��@e�n�`�d��L��:/�F\u001D�V\f�=+\u0005�B�`='a��\u000FC\u001E���\u000E\t�`\u001C�V2��\u001F.�x���U\u001B��,D��\"&��O�,A>L��\u0004m ;���\u00047u\u0016X\u000F�\u0006���\u001A�y��b��\u0010��&�}��TF�?\u0010t������\u001Fh�(��T_t��g\u0011�:���4\u000E]�喌�^\u0011�]r\u0016t\u000B��\u001B'�%S��\u001Dy�<Q\b�Fo\\6@5M^\u0015���\u001E�e�\u000F�\u0005��&�Z��V����;���KF�w=�S�Z\u0015�9�e\u0014�� ^\u001D\u001F�b\u0011i�C�[b����7\u0002\u0003\u0001\u0000\u0001\u0002�\u0001\u0000-!��\u0017���4\u0011q�Y[Qc1�\u001E�u\u000F���\u000E��\t��y\u000F��_x ��\"\u0010\u0016#�hq��\u0000,�\u0012���%3�x�z��R�\u0013\u0019��@\u0011/\u001F�1�D\u0004�mL���x�q�4�\u001F>\"�jYh\u0007��,r�ې�L\u0017�W�1C\u0003��Z\n�C�O�\u001D�\u0019����\n�\u001E/hQ��\u001EMN\u0003�\u001D�E�Չ|Q��s�%�L��v\u0014�p#�C�\u0002�.��\u000F4\u0018t�\u000B�F�?G����/�\u0013yb\u001Dh���LL#��:� 1�� \u0006D�\r��\u0013#\u0015f�yP��Ӣ�X9\u0001�\u0019���\u0017\nE ���l�\u0007�}Љ\u0002��\u0000��b��=j�\u001Eo:��y��l�VR�u4�tG�-����&��P\u001D|\u0013�\u001D��G�#�<�\n�XV7�$-�VD��.e@�\u0007�\u0007s\fr0�\u000B!T�F�`u\u0007�X\u0018%c&U�|��<\u0003�z\f�ն2\u0002�}���݀ ��8���* �@���\u0002��\u0000�\u001B<@#�/<-}�����Tw@^Ãvg\u0000�=�\u0013�\r�ُ�v�\u0014�[4y(-�\u0002�\u0001�\u0014|[\u0001G�b6SY��@�!pH\u00165+��٪�NL�s\bَ���\u0007�\u000B��\u0013�Z��-r\u0002E\u0007��6;~����u/�3�\u000Ej�6�H\u0007jl�\u0002��&����M�&�m\u0013��\u007F\u0013��=[����$�u(�}v�[\u001B�\u0004J��Ļfȭ2���`U��go\u0013Ca�-���M�r8\u0004�E^tz��P\u007F�����yW\u0003\no[;U\u000E#�d\u0380\u0014l�iY���K\"͂����H�\u0010��\f�&���J��\u0003\u0002��n�U����V�\u007F\u0016\f��\u000B*k\rOL\"-�F\u0010oq�.�_\u0018|�\u007F��?K�ϝ�\u001D\u0019����t�K��{���\u001E�X�\b���+^5\u0005�k�f�\u0006��1w�)�9\"��U*m�\u001E�F�|��ў\u0011�otY\u0005�K�7��R�竘9\b�k�{\b�\u0002��z���\u0010?4��ʔ9��A�\u0012��uf�\u0017����?_\u0003\u001E-\u00160�e��������&:��\u0006&��4\u000E�\u0006����n~π�!�f��5\\����̐_�Vc9r��/�n�����\\\u0002�@\u0011[^�\u0017+du+\u0003\n�G\u0010\t\u05CC�\u0004\u0E67��U��Z�jt\u0000\u0006PKCS#8~r\u0000\u0019java.security.KeyRep$Type\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0012\u0000\u0000xr\u0000\u000Ejava.lang.Enum\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0012\u0000\u0000xpt\u0000\u0007PRIVATE
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Server_G11/private/privateKey.key b/Server_G11/private/privateKey.key
--- a/Server_G11/private/privateKey.key	(revision 8f48d8c6e90d40cd8299aa657e5d4687734aa5db)
+++ b/Server_G11/private/privateKey.key	(date 1683658307804)
@@ -1,12 +1,14 @@
 �� sr java.security.KeyRep��O����C L 	algorithmt Ljava/lang/String;[ encodedt [BL formatq ~ L typet Ljava/security/KeyRep$Type;xpt RSAur [B���T�  xp  �0�� 0
 	*�H��
- ��0�� � �bz��[��@e�n�`�d��L��:/�F�V�=+�B�`='a��C���	�`�V2��.�x���U��,D��"&��O�,A>L��m ;���7uX�����y��b����&�}��TF�?t������h�(��T_t��g�:���4]�喌�^�]rt��'�%S��y�<Q�Fo\6@5M^����e����&�Z��V����;���KF�w=�S�Z�9�e�� ^�bi�C�[b����7 � -!�����4q�Y[Qc1��u�����	��y��_x ��"#�hq�� ,����%3�x�z��R���@/�1�D�mL���x�q�4�>"�jYh��,r�ې�L�W�1C��Z
-�C�O������
-�/hQ��MN��E�Չ|Q��s�%�L��v�p#�C��.��4t��F�?G����/�ybh���LL#��:� 1�� D�
-��#f�yP��Ӣ�X9����
-E ���l��}Љ�� ��b��=j�o:��y��l�VR�u4�tG�-����&��P|���G�#�<�
-�XV7�$-�VD��.e@��sr0�!T�F�`u�X%c&U�|��<�z�ն2�}���݀ ��8���* �@����� �<@#�/<-}�����Tw@^Ãvg �=��
-�ُ�v��[4y(-���|[G�b6SY��@�!pH5+��٪�NL�sَ�������Z��-rE��6;~����u/�3�j�6�Hjl���&����M�&�m����=[����$�u(�}v�[�J��Ļfȭ2���`U��goCa�-���M�r8�E^tz��P�����yW
-o[;U#�d΀l�iY���K"͂����H����&���J����n�U����V���*k
-OL"-�Foq�.�_|���?K�ϝ�����t�K��{����X����+^5�k�f���1w�)�9"��U*m��F�|��ў�otY�K�7��R�竘9�k�{���z���?4��ʔ9��A���uf�����?_-0�e��������&:��&��4�����n~π�!�f��5\����̐_�Vc9r��/�n�����\�@[^�+du+
-�G	׌�๧��U��Z�jt PKCS#8~r java.security.KeyRep$Type          xr java.lang.Enum          xpt PRIVATE
\ No newline at end of file
+ ��0�� � ��Ģ�!ERqUN����5o_5�e�΁ި�c����x��ףL�Y�v
+6Ʋ�t�e���@m(1"�F-ok�Ko7���׉�֡LJ�_��#�hC����v28Y�;6�鎉A��%����o75�X�~ц捏����/�� ��c2���w0?��e��bs�lޯݜ}='H,�p^��3�!^�ʋ��v�FC��A{��J��x��;������>����t!�<�;Ę�e�� � ��I|��:հo��*���3�V��?�2��"n���6&�������se�>��-�[iLj08�����(fk����x�Rs�yDx:���M�=J|Uf�T{�YK7�Y�u������m�q��x�u^���a޽hfc�+ <�d��y;)��.�]�;K�D���aUj`>�G�E@d�
+ ��d�R&��^��ER, 
+S�:!�d��Վ��(Y�:8L�
+�U���I>mc/y��O�Kg�t�e*٩n$�;~W<i���� ����jV��Z�aT����� Y�q&��@�7��ے�f9Se�@�g�`��cH/r=�JM��6U���*[2K������\=��^Qy��Ah
+XU���:�R!3Ĝ���#Ţ��W�g:lK�Hw:�
+��� ��D�߫�;�`�U�7Z��
+*,���3��Y��̎��&�0 U�&�k���.
+Rg�Kt�CJ��+��+E[��F�rU٨_�q��:�bh�
+hd�"���3W{��Y;\wv�(ؓ�Kݢໟ��	g#���W�C��~(V"��ˍ�،����Q��p۾&�&�Gh�M�f�N��	����>ג/� x����<�z��ُ�h��%�
+NX��e'U<G~���
+&�{�?=ئ�j#���9��w��+���:��u��S�>e[��Y�2:A[U����8�����Qɏ���H|���I�_�#��ԘZR���s���Ŝ�N��W,Hx���s�nY\�)��H#�����''�|�]Wҭ�Tژ��}�-���B�y��ۦ�$?�0[�cV��i1E����]��r��|�����X��ʏ����8����K>��QZ%�e�Gu7�y��эo���c+o�ܤϺ���_�29|�q@��	3Hz�i���g��t PKCS#8~r java.security.KeyRep$Type          xr java.lang.Enum          xpt PRIVATE
\ No newline at end of file
Index: src/main/java/ClientHandler.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import javax.crypto.SecretKey;\r\nimport java.io.IOException;\r\nimport java.io.ObjectInputStream;\r\nimport java.io.ObjectOutputStream;\r\nimport java.math.BigInteger;\r\nimport java.net.Socket;\r\nimport java.security.PublicKey;\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\n/**\r\n * This class represents the client handler. It handles the communication with the client. It reads the file from the\r\n * server and sends it to the client.\r\n */\r\npublic class ClientHandler extends Thread {\r\n    private final ObjectInputStream in;\r\n    private final ObjectOutputStream out;\r\n    private final Socket client;\r\n    private ArrayList<String> requestSplit;\r\n    private SecretKey clientMACKey;\r\n    private static String DIGEST_ALGORITHM =\"\";\r\n    /**\r\n     * Creates a ClientHandler object by specifying the socket to communicate with the client. All the processing is\r\n     * done in a separate thread.\r\n     *\r\n     * @throws IOException when an I/O error occurs when creating the socket\r\n     */\r\n    public ClientHandler (Socket client) throws Exception {\r\n        this.client = client;\r\n        in = new ObjectInputStream ( this.client.getInputStream ( ) );\r\n        out = new ObjectOutputStream ( this.client.getOutputStream ( ) );\r\n    }\r\n\r\n    @Override\r\n    public void run ( ) {\r\n        super.run ( );\r\n        try {\r\n            sleep(2000);\r\n            PublicKey clientPublicRSAKey;\r\n\r\n            while(RequestUtils.readNumberFromFile(RequestUtils.HANDSHAKE_SIGNAL) != 1){  }\r\n\r\n            clientPublicRSAKey = rsaKeyDistribution ( in );\r\n            BigInteger sharedSecret = agreeOnSharedSecret ( clientPublicRSAKey );\r\n            System.out.println(\"SERVER : Handshake was a sucess.\");\r\n\r\n\r\n            ArrayList<Integer> clientChoice = receiveClientChoice();\r\n            System.out.print(\"SERVER : Client setup \");\r\n            setupClientChoice(clientChoice);\r\n\r\n            this.clientMACKey = receiveMacKey();\r\n            System.out.println(\"SERVER : MAC Key received.\");\r\n\r\n            int i = 0;\r\n            while ( i != 5) {\r\n\r\n                byte[] message = process ( in , sharedSecret.toByteArray ( ), clientChoice);\r\n\r\n                if(message != null ){\r\n                    System.out.println(\"\\n***** REQUEST *****\\n\"+ new String(message));\r\n\r\n                    //Splits message received\r\n\r\n                    requestSplit = RequestUtils.splitRequest(new String(message));\r\n\r\n                    //Regista os número de pedidos feitos por este utilizador\r\n\r\n                    RequestUtils.registerRequests (requestSplit);\r\n                    // Reads the file and sends it to the client\r\n\r\n                    byte[] content = FileHandler.readFile ( RequestUtils.getAbsoluteFilePath ( requestSplit.get(1) ) );\r\n\r\n                    String auxContent = new String(content);\r\n                    System.out.println(\"\\n***** FILE ********\\nHere's the file content: \");\r\n                    System.out.println(auxContent);\r\n\r\n\r\n                    if(content.length>2048) {\r\n\r\n                        sendFile(\"INICIO\".getBytes(), sharedSecret.toByteArray (), clientChoice);\r\n\r\n                        ArrayList<byte[]> contentDividido = ByteUtils.splitByteArray(auxContent.getBytes(),2048 );\r\n\r\n                        for (byte[] bytes : contentDividido) {\r\n\r\n                            sendFile(bytes, sharedSecret.toByteArray(), clientChoice);\r\n                            System.out.println(new String(bytes));\r\n\r\n                        }\r\n                        sendFile(\"FIM\".getBytes(), sharedSecret.toByteArray (), clientChoice);\r\n                    }\r\n                    else {\r\n\r\n                        sendFile(content, sharedSecret.toByteArray (), clientChoice);\r\n\r\n                    }\r\n                    i = RequestUtils.getRequestCounter(requestSplit.get(0));\r\n                }\r\n            }\r\n\r\n            System.out.println(\"\\nClient \"+requestSplit.get(0) +\" exceeded the max requests.\");\r\n            RequestUtils.resetRequestCounter(requestSplit.get(0));\r\n            System.out.println(\"Client \"+requestSplit.get(0) +\" request counter has been reset to 0.\");\r\n\r\n            System.out.println(\"Closing socket connection.\");\r\n\r\n            closeConnection ( );\r\n        } catch ( IOException | ClassNotFoundException e ) {\r\n\r\n            closeConnection ( );\r\n\r\n        } catch (Exception e) {\r\n\r\n            throw new RuntimeException(e);\r\n\r\n        }\r\n    }\r\n    public void setupClientChoice(ArrayList<Integer> clientChoice){\r\n        switch (clientChoice.get(0)) {\r\n            case 0 -> {\r\n                DIGEST_ALGORITHM = \"HmacSHA512\";\r\n                System.out.print(\"[ \" + DIGEST_ALGORITHM + \", \");\r\n            }\r\n            case 1 -> {\r\n                DIGEST_ALGORITHM = \"HmacSHA256\";\r\n                System.out.print(\"[ \" + DIGEST_ALGORITHM + \", \");\r\n            }\r\n            case 2 -> {\r\n                DIGEST_ALGORITHM = \"HmacSHA1\";\r\n                System.out.print(\"[ \" + DIGEST_ALGORITHM + \", \");\r\n            }\r\n            case 3 -> {\r\n                DIGEST_ALGORITHM = \"HmacMD5\";\r\n                System.out.print(\"[ \" + DIGEST_ALGORITHM + \", \");\r\n            }\r\n        }\r\n        switch (clientChoice.get(1)) {\r\n            case 0 -> System.out.print(\"AES ]\");\r\n            case 1 -> System.out.print(\"DES ]\");\r\n            case 2 -> System.out.print(\"3DES ]\");\r\n        }\r\n        System.out.println(\"\\n\");\r\n    }\r\n\r\n    public static List<String> splitStringBySize(String input) {\r\n        List<String> output = new ArrayList<>();\r\n\r\n        // Verifica o tamanho da string em bytes\r\n        int inputSize = input.getBytes().length;\r\n\r\n        if (inputSize <= 2048) { // Se o tamanho for menor ou igual a 2KB, adiciona a string inteira na lista de saída\r\n            output.add(input);\r\n        } else { // Caso contrário, divide a string em pedaços de no máximo 2KB\r\n            int numParts = (int) Math.ceil((double) inputSize / 2048); // Calcula o número de pedaços necessários\r\n            int remainingBytes = inputSize;\r\n            int start = 0;\r\n            int end = 0;\r\n\r\n            for (int i = 0; i < numParts; i++) {\r\n                end += Math.min(remainingBytes, 2048); // Define o final do pedaço, garantindo que não ultrapasse 2KB\r\n                String part = input.substring(start, end); // Extrai o pedaço da string original\r\n                output.add(part); // Adiciona o pedaço na lista de saída\r\n                start = end;\r\n                remainingBytes = inputSize - end;\r\n            }\r\n        }\r\n\r\n        return output;\r\n    }\r\n\r\n    /**\r\n     * Sends the file to the client\r\n     *\r\n     * @param content the content of the file to send\r\n     *\r\n     * @throws IOException when an I/O error occurs when sending the file\r\n     */\r\n    private void sendFile ( byte[] content , byte[] sharedSecret , ArrayList<Integer> choice) throws Exception {\r\n        byte[] encryptedResponse = null;\r\n\r\n        if(choice.get(1) == 0){ //AES\r\n            encryptedResponse = AES.encrypt ( content , sharedSecret );\r\n        }\r\n        if(choice.get(1) == 1){ //DES\r\n            encryptedResponse = DES.encrypt ( content , sharedSecret );\r\n        }\r\n        if(choice.get(1) == 2){ //DES\r\n            encryptedResponse = DES3.encrypt ( content , sharedSecret );\r\n        }\r\n\r\n        byte[] digest = Hmac.hmac(content, DIGEST_ALGORITHM,clientMACKey.getEncoded());\r\n        // Creates the message object\r\n        Message responseObj = new Message ( encryptedResponse , digest );\r\n        // Sends the encrypted message\r\n        out.writeObject ( responseObj );\r\n        out.flush ( );\r\n    }\r\n\r\n    /**\r\n     * Closes the connection by closing the socket and the streams.\r\n     */\r\n    private void closeConnection ( ) {\r\n        try {\r\n            client.close ( );\r\n            out.close ( );\r\n            in.close ( );\r\n        } catch ( IOException e ) {\r\n            throw new RuntimeException ( e );\r\n        }\r\n    }\r\n    private SecretKey receiveMacKey() throws IOException, ClassNotFoundException {\r\n        return  ( SecretKey ) in.readObject ( );\r\n    }\r\n    private ArrayList<Integer> receiveClientChoice () throws IOException, ClassNotFoundException {\r\n        return (ArrayList<Integer>) in.readObject();\r\n    }\r\n    //DIFFIE HELLLMAN\r\n    private PublicKey rsaKeyDistribution (ObjectInputStream in ) throws Exception {\r\n        // Extract the public key\r\n        PublicKey senderPublicRSAKey = ( PublicKey ) in.readObject ( );\r\n        // Send the public key\r\n        sendPublicRSAKey ( );\r\n        return senderPublicRSAKey;\r\n    }\r\n    private void sendPublicRSAKey ( ) throws Exception {\r\n        out.writeObject ( Server.getPublicRSAKey());\r\n        out.flush ( );\r\n    }\r\n\r\n    private void sendPublicDHKey ( BigInteger publicKey ) throws Exception {\r\n        out.writeObject ( RSA.encryptRSA ( publicKey.toByteArray ( ) , Server.getPrivateRSAKey()));\r\n    }\r\n    /**\r\n     * Performs the Diffie-Hellman algorithm to agree on a shared private key.\r\n     *\r\n     * @param senderPublicRSAKey the public key of the sender\r\n     *\r\n     * @return the shared secret key\r\n     *\r\n     * @throws Exception when the key agreement protocol fails\r\n     */\r\n    private BigInteger agreeOnSharedSecret ( PublicKey senderPublicRSAKey ) throws Exception {\r\n        // Generate a pair of keys\r\n        BigInteger privateKey = DiffieHellman.generatePrivateKey ( );\r\n        BigInteger publicKey = DiffieHellman.generatePublicKey ( privateKey );\r\n        // Extracts the public key from the request\r\n        BigInteger clientPublicKey = new BigInteger ( RSA.decryptRSA ( ( byte[] ) in.readObject ( ) , senderPublicRSAKey ) );\r\n        // Send the public key to the client\r\n        sendPublicDHKey ( publicKey );\r\n        // Generates the shared secret\r\n        return DiffieHellman.computePrivateKey ( clientPublicKey , privateKey );\r\n    }\r\n\r\n    private byte[] process ( ObjectInputStream in , byte[] sharedSecret, ArrayList<Integer> clientChoice ) throws Exception {\r\n        // Reads the message object\r\n        Message messageObj = ( Message ) in.readObject ( );\r\n        // Extracts and decrypt the message\r\n\r\n        byte[] decryptedMessage = null;\r\n        if(clientChoice.get(1) == 0){\r\n            decryptedMessage = AES.decrypt ( messageObj.getMessage ( ) , sharedSecret );\r\n        }\r\n        if(clientChoice.get(1) == 1){\r\n            decryptedMessage = DES.decrypt ( messageObj.getMessage ( ) , sharedSecret );\r\n        }\r\n        if(clientChoice.get(1) == 2){\r\n            decryptedMessage = DES3.decrypt ( messageObj.getMessage ( ) , sharedSecret );\r\n        }\r\n\r\n        // Computes the digest of the received message\r\n        byte[] computedDigest = Hmac.hmac(decryptedMessage, DIGEST_ALGORITHM,clientMACKey.getEncoded());\r\n        if ( ! Hmac.verifyDigest ( messageObj.getSignature ( ) , computedDigest ) ) {\r\n            throw new RuntimeException ( \"The integrity of the message is not verified\" );\r\n        }\r\n\r\n        return decryptedMessage;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/ClientHandler.java b/src/main/java/ClientHandler.java
--- a/src/main/java/ClientHandler.java	(revision 8f48d8c6e90d40cd8299aa657e5d4687734aa5db)
+++ b/src/main/java/ClientHandler.java	(date 1683657296156)
@@ -44,11 +44,9 @@
             BigInteger sharedSecret = agreeOnSharedSecret ( clientPublicRSAKey );
             System.out.println("SERVER : Handshake was a sucess.");
 
-
             ArrayList<Integer> clientChoice = receiveClientChoice();
             System.out.print("SERVER : Client setup ");
             setupClientChoice(clientChoice);
-
             this.clientMACKey = receiveMacKey();
             System.out.println("SERVER : MAC Key received.");
 
@@ -120,19 +118,19 @@
         switch (clientChoice.get(0)) {
             case 0 -> {
                 DIGEST_ALGORITHM = "HmacSHA512";
-                System.out.print("[ " + DIGEST_ALGORITHM + ", ");
+                System.out.print("[ " + DIGEST_ALGORITHM + " , ");
             }
             case 1 -> {
                 DIGEST_ALGORITHM = "HmacSHA256";
-                System.out.print("[ " + DIGEST_ALGORITHM + ", ");
+                System.out.print("[ " + DIGEST_ALGORITHM + " , ");
             }
             case 2 -> {
                 DIGEST_ALGORITHM = "HmacSHA1";
-                System.out.print("[ " + DIGEST_ALGORITHM + ", ");
+                System.out.print("[ " + DIGEST_ALGORITHM + " , ");
             }
             case 3 -> {
                 DIGEST_ALGORITHM = "HmacMD5";
-                System.out.print("[ " + DIGEST_ALGORITHM + ", ");
+                System.out.print("[ " + DIGEST_ALGORITHM + " , ");
             }
         }
         switch (clientChoice.get(1)) {
